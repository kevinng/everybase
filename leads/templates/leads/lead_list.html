{% extends 'extendables/b.html' %}

{% load static %}

{% block title %}Importers/Exporters Need Agents{% endblock %}

{% comment %}
CSS

#mobile-filter {
    position: fixed;
    top: 0;
    left: 100%;
    width: 100%;
    min-height: 100vh;
    display: block;
    z-index: 98;
    background-color: white;
    padding-top: 100px;
    transition: 0.3s;
    max-height: 100%;
    overflow-y: scroll;
}

#mobile-filter.is-active {
    left: 0;
}
{% endcomment %}
{% block other_css %}
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<link href="{% static 'common/css/mobile_filter.min.css' %}" rel="stylesheet" />
{% endblock %}

{% block page_actions %}
<div class="flex lg:hidden">
    <a href="{% url 'leads:lead_create' %}" class="w-full py-2 px-4 rounded-md bg-blue-100 border border-blue-700 hover:bg-blue-200 shadow-md text-center block">Post a Lead</a>
    <button id="search" class="text-slate-600 shadow-md bg-slate-100 hover:bg-slate-200 rounded px-4 py-2 ml-2">Search</button>
</div>
{% endblock %}

{% block content %}
<div class="text-3xl font-bold text-center mt-10">Leads</div>
<div class="text-center mt-2">Buyers and sellers looking for agents</div>
<div class="flex justify-center mb-10 mt-10 gap-2">
    {% comment %} start: desktop search {% endcomment %}
    <div class="bg-white rounded shadow-md hidden lg:block lg:w-1/3 xl:w-1/4 self-start px-6 py-10">
        <a href="{% url 'leads:lead_create' %}" class="w-full py-2 px-7 rounded-md bg-blue-100 border border-blue-700 hover:bg-blue-200 shadow-md text-center block">Post a Lead</a>
        <div class="mt-7 flex flex-col justify-center">
            <form action="{% url 'leads:lead_list' %}" type="get">

                {% comment %} start: search {% endcomment %}
                <label id="search__label" for="search" class="font-bold text-slate-400 mt-5 block">Search</label>
                <input id="search" name="search"{% if search is not None and search|cut:' ' != '' %} value="{{ search }}"{% endif %} placeholder="Leave blank for all" type="text" maxlength="50" class="block w-full border rounded-md py-3 px-5 mt-2">
                {% comment %} end: search {% endcomment %}
                
                {% comment %} start: buy_sell {% endcomment %}
                <label id="buy_sell__label" for="buy_sell" class="font-bold text-slate-400 mt-5 block">Buying or Selling?</label>
                <div id="buy_sell__elements" class="mt-2">
                    <select name="buy_sell" class="select2">
                        <option value="all"{% if buy_sell == 'all' %} selected{% endif %}>Buy or Sell</option>
                        <option value="buy"{% if buy_sell == 'buy' %} selected{% endif %}>Buy</option>
                        <option value="sell"{% if buy_sell == 'sell' %} selected{% endif %}>Sell</option>
                    </select>
                </div>
                {% comment %} end: buy_sell {% endcomment %}

                {% comment %} start: buy_country {% endcomment %}
                <label id="buy_country__label" for="buy_country" class="font-bold text-slate-400 mt-5 block">Buy or Source Country</label>
                <div id="buy_country__elements" class="mt-2">
                    <select id="buy_country" name="buy_country" class="select2">
                        <option value="any_country"{% if buy_country == 'any_country' %} selected{% endif %}>Any Country</option>
                        {% for country in countries %}
                            <option value="{{ country.programmatic_key }}"{% if buy_country == country.programmatic_key %} selected{% endif %}>{{ country.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                {% comment %} end: buy_country {% endcomment %}

                {% comment %} start: sell_country {% endcomment %}
                <label id="sell_country__label" for="sell_country" class="font-bold text-slate-400 mt-5 block">Sell or Destination Country</label>
                <div id="sell_country__elements" class="mt-2">
                    <select name="sell_country" class="select2">
                        <option value="any_country"{% if sell_country == 'any_country' %} selected{% endif %}>Any Country</option>
                        {% for country in countries %}
                            <option value="{{ country.programmatic_key }}"{% if sell_country == country.programmatic_key %} selected{% endif %}>{{ country.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                {% comment %} end: sell_country {% endcomment %}

                <button id="submit" type="submit" class="w-full py-3 px-7 rounded-md text-white bg-blue-500 hover:bg-blue-600 mt-6 shadow-md">Search</button>

                <div class="mt-2 flex justify-center">
                    <a href="{% url 'leads:lead_list' %}" class="py-3 px-7 w-full text-center bg-slate-200 hover:bg-slate-300 rounded-md">Reset</a>
                </div>
            </form>
        </div>
    </div>
    {% comment %} end: desktop filter {% endcomment %}
    {% comment %} start: mobile filter {% endcomment %}
    <nav id="mobile-filter" class="px-10 py-10">
        <a href="{% url 'leads:lead_create' %}" class="w-full py-2 px-7 rounded-md bg-blue-100 border border-blue-700 hover:bg-blue-200 shadow-md text-center block">Post a Lead</a>
        <h1 class="text-3xl font-bold text-center mt-6">Leads</h1>
        <div class="mt-7 flex flex-col justify-center">
            <form action="{% url 'leads:lead_list' %}" type="get">

                {% comment %} start: search {% endcomment %}
                <label id="mob__search__label" for="mob__search" class="font-bold text-slate-400 mt-5 block">Search</label>
                <input id="mob__search" name="search"{% if search is not None and search|cut:' ' != '' %} value="{{ search }}"{% endif %} placeholder="Leave blank for all" type="text" maxlength="50" class="block w-full border rounded-md py-3 px-5 mt-2">
                {% comment %} end: search {% endcomment %}                
                
                {% comment %} start: buy_sell {% endcomment %}
                <label id="mob__buy_sell__label" for="mob__buy_sell" class="font-bold text-slate-400 mt-5 block">Buying or Selling?</label>
                <div id="mob__buy_sell__elements" class="mt-2">
                    <select id="mob__buy_sell" name="buy_sell" class="select2">
                        <option value="all"{% if buy_sell == 'all' %} selected{% endif %}>Buy or Sell</option>
                        <option value="buy"{% if buy_sell == 'buy' %} selected{% endif %}>Buy</option>
                        <option value="sell"{% if buy_sell == 'sell' %} selected{% endif %}>Sell</option>
                    </select>
                </div>
                {% comment %} end: buy_sell {% endcomment %}

                {% comment %} start: buy_country {% endcomment %}
                <label id="mob__buy_country__label" for="mob__buy_country" class="font-bold text-slate-400 mt-5 block">Buy or Source Country</label>
                <div id="mob__buy_country__elements" class="mt-2">
                    <select id="mob__buy_country" name="buy_country" class="select2">
                        <option value="any_country"{% if buy_country == 'any_country' %} selected{% endif %}>Any Country</option>
                        {% for country in countries %}
                            <option value="{{ country.programmatic_key }}"{% if buy_country == country.programmatic_key %} selected{% endif %}>{{ country.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                {% comment %} end: buy_country {% endcomment %}

                {% comment %} start: sell_country {% endcomment %}
                <label id="mob__sell_country__label" for="mob__sell_country" class="font-bold text-slate-400 mt-5 block">Sell or Destination Country</label>
                <div id="mob__sell_country__elements" class="mt-2">
                    <select id="mob__sell_country" name="sell_country" class="select2">
                        <option value="any_country"{% if sell_country == 'any_country' %} selected{% endif %}>Any Country</option>
                        {% for country in countries %}
                            <option value="{{ country.programmatic_key }}"{% if sell_country == country.programmatic_key %} selected{% endif %}>{{ country.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                {% comment %} end: sell_country {% endcomment %}

                <button id="mob__submit" type="submit" class="w-full py-3 px-7 rounded-md text-white bg-blue-500 hover:bg-blue-600 mt-6 shadow-md">Search</button>

                <div class="mt-4 flex justify-center">
                    {% comment %} Won't trigger an Amplitude call {% endcomment %}
                    <a href="{% url 'leads:lead_list' %}" class="py-3 px-7 w-full text-center bg-slate-200 hover:bg-slate-300 rounded-md">Reset</a>
                </div>
            </form>
        </div>
    </nav>
    {% comment %} end: mobile filter {% endcomment %}

    <div class="w-5/6 lg:w-6/12 xl:w-7/12 2xl:w-6/12">
        {% comment %} start: page item count > 0 {% endcomment %}
        {% if page_obj|length > 0 %}

        {% include 'includes/paginator.html' %}

        {% for lead in page_obj %}

        <div class="mt-2">
            {% include 'leads/includes/lead_item.html' with position=forloop.counter %}
        </div>

        {% endfor %}

        {% include 'includes/paginator.html' with other_css_classes='mt-5' %}
        
        {% else %}
        {% comment %} else: page item count <= 0 {% endcomment %}

        <div class="text-lg text-center">No results</div>   

        {% endif %}
        {% comment %} end: page item count > 0 {% endcomment %}
    </div>
</div>
{% endblock %}

{% comment %}
Javascript
https://codebeautify.org/minify-js

// Minified and reference, no rendered values

$(document).ready(function() {
    // Cache references
    $select2 = $('.select2')
    $search = $('#search')

    // Initialize select2 checkboxes
    $select2.select2();
    $select2.one('select2:open', function(e) {
        $('input.select2-search__field').prop('placeholder', 'Search here...');
    })

    // Mobile menu
    $search.click(function() {
        t = $(this)
        if (t.html() == 'Search') {
            t.html('Close')
        } else {
            t.html('Search')
        }

        t.toggleClass('bg-blue-500')
        t.toggleClass('text-white')
        t.toggleClass('hover:bg-blue-600')
        t.toggleClass('bg-slate-100')
        t.toggleClass('text-slate-600')
        t.toggleClass('hover:bg-slate-200')

        $('#mobile-filter').toggleClass('is-active')
    })
})

// Rendered inline, have rendered values

$(document).ready(function() {
    // Cache references
    $mob__submit = $('#mob__submit')
    $submit = $('#submit')
    $next_page = $('.next_page')
    $prev_page = $('.prev_page')
    $lead_item = $('.lead_item')

    // Amplitude call on form submit
    function submit_clicked(menu_type) {
        var event = 'discovery - searched leads'
        var props = {
            'search': '{% if search is None %}{% else %}{{ search }}{% endif %}',
            'buy_sell': '{% if search is None %}{% else %}{{ buy_sell }}{% endif %}',
            'buy_country': '{% if search is None %}{% else %}{{ buy_country }}{% endif %}',
            'sell_country': '{% if search is None %}{% else %}{{ sell_country }}{% endif %}',
            'menu_type': menu_type
        }
        console.log(props)
        amplitude.getInstance().logEvent(event, props)
    }
    $mob__submit.click(function() { submit_clicked('mobile') })
    $submit.click(function() { submit_clicked('desktop') })

    // Amplitude call on next page
    function next_page_clicked() {
        var event = 'discovery - clicked lead list next page'
        var props = {
            'current_page': '{{ page_obj.number }}'
        }
        amplitude.getInstance().logEvent(event, props)
    }
    $next_page.click(function() { next_page_clicked() })

    // Amplitude call on previous page
    function previous_page_clicked() {
        var event = 'discovery - clicked lead list previous page'
        var props = {
            'current_page': '{{ page_obj.number }}'
        }
        amplitude.getInstance().logEvent(event, props)
    }
    $prev_page.click(function() { previous_page_clicked() })

    // Amplitude call on item clicked
    function item_clicked(
        lead_id,
        page,
        position,
        num_images,
        age_days,
        buy_sell,
        buy_country,
        sell_country,
        commission_type,
        commission_percentage,
        commission_earnings,
        commission_quantity_unit_string,
        is_comm_negotiable
    ) {
        var event = 'discovery - clicked lead item'
        var props = {
            'lead_id': lead_id,
            'page': page,
            'position': position,
            'num_images': num_images,
            'age_days': age_days,
            'buy_sell': buy_sell,
            'buy_country': buy_country,
            'sell_country': sell_country,
            'commission_type': commission_type,
            'commission_percentage': commission_percentage,
            'commission_earnings': commission_earnings,
            'commission_quantity_unit_string': commission_quantity_unit_string,
            'is_comm_negotiable': is_comm_negotiable
        }
        amplitude.getInstance().logEvent(event, props)
    }
    $lead_item.click(function() {
        t = $(this)
        item_clicked(
            t.attr('data-lead-id'),
            '{{ page_obj.number }}',
            t.attr('data-position'),
            t.attr('data-num-images'),
            t.attr('data-age-days'),
            t.attr('data-buy-sell'),
            t.attr('data-buy-country'),
            t.attr('data-sell-country'),
            t.attr('data-commission-type'),
            t.attr('data-commission-percentage'),
            t.attr('data-commission-earnings'),
            t.attr('data-commission-quantity-unit-string'),
            t.attr('data-is-comm-negotiable')
        )
    })
})
{% endcomment %}
{% block other_script %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<script src="{% static 'leads/js/lead_list.min.js' %}"></script>
<script>$(document).ready((function(){function e(e){var t={search:"{% if search is None %}{% else %}{{ search }}{% endif %}",buy_sell:"{% if search is None %}{% else %}{{ buy_sell }}{% endif %}",buy_country:"{% if search is None %}{% else %}{{ buy_country }}{% endif %}",sell_country:"{% if search is None %}{% else %}{{ sell_country }}{% endif %}",menu_type:e};console.log(t),amplitude.getInstance().logEvent("discovery - searched leads",t)}$mob__submit=$("#mob__submit"),$submit=$("#submit"),$next_page=$(".next_page"),$prev_page=$(".prev_page"),$lead_item=$(".lead_item"),$mob__submit.click((function(){e("mobile")})),$submit.click((function(){e("desktop")})),$next_page.click((function(){amplitude.getInstance().logEvent("discovery - clicked lead list next page",{current_page:"{{ page_obj.number }}"})})),$prev_page.click((function(){amplitude.getInstance().logEvent("discovery - clicked lead list previous page",{current_page:"{{ page_obj.number }}"})})),$lead_item.click((function(){var e,a,i,n,s,o,c,l,r,m,u,d,_,g;t=$(this),e=t.attr("data-lead-id"),a="{{ page_obj.number }}",i=t.attr("data-position"),n=t.attr("data-num-images"),s=t.attr("data-age-days"),o=t.attr("data-buy-sell"),c=t.attr("data-buy-country"),l=t.attr("data-sell-country"),r=t.attr("data-commission-type"),m=t.attr("data-commission-percentage"),u=t.attr("data-commission-earnings"),d=t.attr("data-commission-quantity-unit-string"),_=t.attr("data-is-comm-negotiable"),g={lead_id:e,page:a,position:i,num_images:n,age_days:s,buy_sell:o,buy_country:c,sell_country:l,commission_type:r,commission_percentage:m,commission_earnings:u,commission_quantity_unit_string:d,is_comm_negotiable:_},amplitude.getInstance().logEvent("discovery - clicked lead item",g)}))}));</script>
{% endblock %}