{% extends 'extendables/b.html' %}

{% load static %}

{% comment %} TODO {% endcomment %}

{% comment %} Put in all the on-page SEO here {% endcomment %}
{% comment %} Include keywords {% endcomment %}
{% comment %}
Title is optimized for SEO purposes. String format:
- Buyer or seller
- If buying, source country. If selling, destination country.
- Goods/services keywords
We want to cache the title, so the code doesn't have to run each and everytime the page is loaded
{% endcomment %}

{% comment %}
CSS
https://codebeautify.org/css-beautify-minify

{% endcomment %}
{% block other_css %}
<link href="{% static 'common/photoswipe/photoswipe.min.css' %}" rel="stylesheet" />
<link href="{% static 'common/photoswipe/default-skin/default-skin.min.css' %}" rel="stylesheet" />
{% endblock %}

{% block title %}{% endblock %}

{% block page_actions %}
{% comment %} WRONG {% endcomment %}
{% include 'relationships/includes/user_detail_actions.html' with detail_user=lead.author %}
{% endblock %}

{% block content %}
<div class="flex flex-col lg:flex-row justify-center mt-10 mb-10 gap-2">
    {% include 'relationships/includes/user_detail_side.html' with detail_user=lead.author %}


    {% comment %} SHALL I INCLUDE A FLOATING BUTTON THAT JUMPS TO THE USER SECTION IN MOBILE MODE? IN MOBILE WE DON'T REALLY WNAT TO SHOW USER ON TOP, BUT IT'S TOO FAR DOWN THE SCREEN {% endcomment %}
    <div class="w-full lg:w-1/2 lg:mt-0 mt-4">

        <div class="bg-white rounded px-8 py-8 shadow-md">
            <div class="flex items-start justify-between">
                <div class="text-xl font-bold">{% if lead.lead_type == 'buying' %}Buying{% elif lead.lead_type == 'selling' %}Selling{% endif %}, {% if lead.author_type == 'direct' %}Direct {% if lead.lead_type == 'buying' %}Buyer{% elif lead.lead_type == 'selling' %}Seller{% endif %}{% elif lead.author_type == 'broker' %}Middleman{% endif %}</div>
                <div class="text-sm">{{ lead.age_desc }}</div>
            </div>

            {% comment %} start: thumbnails {% endcomment %}
            <div class="flex items-start justify-start mt-4 gap-2 image-gallery" itemscope itemtype="http://schema.org/ImageGallery">
                {% load thumbnail_url %}
                {% load image_url %}
                {% for file in lead.files.all %}
                    {% thumbnail_url file as thumbnail_url %}
                    {% image_url file as image_url %}
                    <figure itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
                        <a href="{{ image_url }}" itemprop="contentUrl" data-size="{{ file.width }}x{{ file.height }}">
                            <img src="{{ thumbnail_url }}" itemprop="thumbnail" class="shadow-md">
                        </a>
                    </figure>
                {% endfor %}
            </div>
            {% comment %} end: thumbnails {% endcomment %}

            {% comment %} start: buy_country {% endcomment %}
            <div class="font-bold text-slate-400 mt-6">{% if lead.lead_type == 'selling' %}Source Country{% elif lead.lead_type == 'buying' %}Buy From This Country{% endif %}</div>
            <div class="mt-1">{% if lead.buy_country is not None %}{{ lead.buy_country.name }}{% else %}Any Country{% endif %}</div>
            <div class="mt-1 italic">{% if lead.lead_type == 'selling' %}Country the goods/services are exported from or based in.{% elif lead.lead_type == 'buying' %}Country buyer would like to buy or source from.{% endif %}</div>
            {% comment %} end: buy_country {% endcomment %}

            {% comment %} start: sell_country {% endcomment %}
            <div class="font-bold text-slate-400 mt-4">{% if lead.lead_type == 'selling' %}Sell In This Country{% elif lead.lead_type == 'buying' %}Destination Country{% endif %}</div>
            <div class="mt-1">{% if lead.sell_country is not None %}{{ lead.sell_country.name }}{% else %}Any Country{% endif %}</div>
            <div class="mt-1 italic">{% if lead.lead_type == 'selling' %}Country seller would like to sell the goods/services in.{% elif lead.lead_type == 'buying' %}Country the goods/services are imported into or needed.{% endif %}</div>
            {% comment %} end: sell_country {% endcomment %}

            {% comment %} start: details {% endcomment %}
            <div class="font-bold text-slate-400 mt-4">Goods/Services Details</div>
            <div class="mt-1">{{ lead.details }}</div>
            {% comment %} end: details {% endcomment %}
            
            {% comment %} start: need_agent {% endcomment %}
            {% if lead.need_agent %}
                <div class="text-xl font-bold mt-6">I need selling or promoting agents</div>

                {% if lead.commission_type == 'percentage' %}

                {% comment %} start: commission {% endcomment %}
                <div class="font-bold text-slate-400 mt-4">Agent Commission</div>
                <div class="mt-1">{{ lead.commission }} % of Sales</div>
                {% comment %} end: commission {% endcomment %}

                {% comment %} start: avg_deal_size {% endcomment %}
                <div class="font-bold text-slate-400 mt-4">Average Deal Size</div>
                <div class="mt-1">USD {{ lead.avg_deal_size|floatformat:2 }}</div>
                {% comment %} end: avg_deal_size {% endcomment %}

                {% comment %} start: avg_deal_comm {% endcomment %}
                <div class="font-bold text-slate-400 mt-4">Average Earnings Per Deal</div>
                <div class="mt-1">USD {{ lead.avg_deal_comm|floatformat:2 }}</div>
                {% comment %} end: avg_deal_comm {% endcomment %}

                {% comment %} start: commission_payable_after {% endcomment %}
                <div class="font-bold text-slate-400 mt-4">Commission Payable After</div>
                <div class="mt-1">{% if lead.commission_payable_after == 'initial_deposit_received' %}Initial Deposit Received{% elif lead.commission_payable_after == 'goods_shipped' %}Goods Shipped{% elif lead.commission_payable_after == 'buyer_received_goods_services' %}Buyer Received Goods/Services{% elif lead.commission_payable_after == 'full_payment_received' %}Full Payment Received{% elif lead.commission_payable_after == 'other' %}{{ lead.commission_payable_after_other }}{% endif %}</div>
                {% comment %} end: commission_payable_after {% endcomment %}

                {% comment %} start: other_agent_details {% endcomment %}
                <div class="font-bold text-slate-400 mt-4">Other Details For {% if lead.lead_type == 'selling' %}Selling{% elif lead.lead_type == 'buying' %}Buying{% endif %} Agent</div>
                <div class="mt-1">{{ lead.other_agent_details }}</div>
                {% comment %} end: other_agent_details {% endcomment %}

                {% elif lead.commission_type == 'other' %}

                <div class="font-bold text-slate-400 mt-4">{% if lead.lead_type == 'selling' %}Selling{% elif lead.lead_type == 'buying' %}Buying{% endif %} Agent Commission</div>
                <div class="mt-1">{{ lead.commission_type_other }}</div>

                {% endif %}

                {% comment %} start: is_comm_negotiable {% endcomment %}
                {% if lead.is_comm_negotiable == True %}
                <div class="italic mt-4">Commission may differ and is negotiable for each deal.</div>
                {% endif %}
                {% comment %} end: is_comm_negotiable {% endcomment %}

            {% endif %}
            {% comment %} end: need_agent {% endcomment %}

            {% if lead.need_logistics_agent %}
                <div class="text-xl font-bold mt-6">I need logistics agents</div>

                <div class="font-bold text-slate-400 mt-4">Logistics Needs</div>
                <div class="mt-1">{{ lead.other_logistics_agent_details }}</div>
            {% endif %}

            <div class="flex justify-end mt-8">
                {% if user.is_authenticated == True and user.user.id == lead.author.id %}
                    <a href="{% url 'leads:lead_edit' lead.id %}" class="px-6 py-2 ml-2 text-slate-600 shadow-md bg-slate-100 hover:bg-slate-200 rounded-md">Edit</a>
                {% elif user.user.id != lead.author.id %}
                    {% if user.is_authenticated == True %}
                        {% comment %} Allow toggling of save-unsave asynchronously {% endcomment %}
                        {% load has_saved_lead %}
                        {% has_saved_lead user.user lead as has_saved_lead %}
                        <button id="toggle_save_lead" class="py-2 px-4 mt-2 rounded-md shadow-md {% if has_saved_lead == True %}text-white bg-blue-500 hover:bg-blue-600{% else %}text-slate-600 bg-slate-100 hover:bg-slate-200{% endif %}">{% if has_saved_lead == True %}Lead Saved{% else %}Save Lead{% endif %}</button>
                    {% else %}
                        {% comment %} Direct user to login and come back to this page with lead saved {% endcomment %}
                        <a href="" class="py-2 px-4 mt-2 rounded-md text-slate-600 shadow-md bg-slate-100 hover:bg-slate-200">Save Lead</a>
                    {% endif %}
                {% endif %}
            </div>
        </div>
        




    </div>
</div>
{% comment %} PhotoSwipe library HTML code to be inserted before end of body tag. {% endcomment %}
{% include 'includes/photoswipe.html' %}
{% endblock %}

{% comment %}
Dependences:
    JQuery

$(document).ready(function() {
    // Save/unsave user
    $toggle_save_user = $('#toggle_save_user')
    $toggle_save_user.click(function () {
        // Make AJAX call to save user, and update button look.
        $.ajax({
            type: 'POST',
            url: "{% url 'users:toggle_save_user' lead.author.id %}",
            dataType: 'json',
            success: function (data) {
                if (data['s'] == true) {
                    $toggle_save_user
                        .removeClass('text-slate-600 bg-slate-100 hover:bg-slate-200')
                        .addClass('text-white bg-blue-500 hover:bg-blue-600')
                        .text('Person Saved')
                } else {
                    $toggle_save_user
                        .addClass('text-slate-600 bg-slate-100 hover:bg-slate-200')
                        .removeClass('text-white bg-blue-500 hover:bg-blue-600')
                        .text('Save Person')
                }
            }
        })
    })

    // Save/unsave lead
    $toggle_save_lead = $('#toggle_save_lead')
    $toggle_save_lead.click(function () {
        // Make AJAX call to save lead, and update button look.
        $.ajax({
            type: 'POST',
            url: "{% url 'leads:toggle_save_lead' lead.id %}",
            dataType: 'json',
            success: function (data) {
                if (data['s'] == true) {
                    $toggle_save_lead
                        .removeClass('text-slate-600 bg-slate-100 hover:bg-slate-200')
                        .addClass('text-white bg-blue-500 hover:bg-blue-600')
                        .text('Lead Saved')
                } else {
                    $toggle_save_lead
                        .addClass('text-slate-600 bg-slate-100 hover:bg-slate-200')
                        .removeClass('text-white bg-blue-500 hover:bg-blue-600')
                        .text('Save Lead')
                }
            }
        })
    })
})
{% endcomment %}
{% block other_script %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="{% static 'common/photoswipe/photoswipe.min.js' %}"></script>
<script src="{% static 'common/photoswipe/photoswipe-ui-default.min.js' %}"></script>
<script src="{% static 'common/photoswipe/photoswipe-everybase.min.js' %}"></script>
<script>{% comment %} Embedded here because URL needs to be rendered into code. {% endcomment %}
$(document).ready((function(){$toggle_save_user=$("#toggle_save_user"),$toggle_save_user.click((function(){$.ajax({type:"POST",url:"{% url 'users:toggle_save_user' lead.author.id %}",dataType:"json",success:function(e){1==e.s?$toggle_save_user.removeClass("text-slate-600 bg-slate-100 hover:bg-slate-200").addClass("text-white bg-blue-500 hover:bg-blue-600").text("Person Saved"):$toggle_save_user.addClass("text-slate-600 bg-slate-100 hover:bg-slate-200").removeClass("text-white bg-blue-500 hover:bg-blue-600").text("Save Person")}})})),$toggle_save_lead=$("#toggle_save_lead"),$toggle_save_lead.click((function(){$.ajax({type:"POST",url:"{% url 'leads:toggle_save_lead' lead.id %}",dataType:"json",success:function(e){1==e.s?$toggle_save_lead.removeClass("text-slate-600 bg-slate-100 hover:bg-slate-200").addClass("text-white bg-blue-500 hover:bg-blue-600").text("Lead Saved"):$toggle_save_lead.addClass("text-slate-600 bg-slate-100 hover:bg-slate-200").removeClass("text-white bg-blue-500 hover:bg-blue-600").text("Save Lead")}})}))}));
</script>
{% endblock %}