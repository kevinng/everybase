{% extends 'extendables/base.html' %}

{% load static %}
{% load has_contacted %}
{% load is_connected %}

{% block subtitle %}{{ lead.title }} | {% endblock %}

{% block page_title %}Lead Details{% endblock %}

{% comment %} {% block actions %}

<button class="btn btn-sm btn-secondary me-2 ">Back</button>

<button class="btn btn-sm btn-light-danger fs-7"><span class="svg-icon svg-icon-3">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
        <path d="M18.3721 4.65439C17.6415 4.23815 16.8052 4 15.9142 4C14.3444 4 12.9339 4.73924 12.003 5.89633C11.0657 4.73913 9.66 4 8.08626 4C7.19611 4 6.35789 4.23746 5.62804 4.65439C4.06148 5.54462 3 7.26056 3 9.24232C3 9.81001 3.08941 10.3491 3.25153 10.8593C4.12155 14.9013 9.69287 20 12.0034 20C14.2502 20 19.875 14.9013 20.7488 10.8593C20.9109 10.3491 21 9.81001 21 9.24232C21.0007 7.26056 19.9383 5.54462 18.3721 4.65439Z" fill="black"/>
    </svg></span> Saved</button>
    
    <button class="btn btn-sm btn-light fs-7"><span class="svg-icon svg-icon-3">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
            <path d="M18.3721 4.65439C17.6415 4.23815 16.8052 4 15.9142 4C14.3444 4 12.9339 4.73924 12.003 5.89633C11.0657 4.73913 9.66 4 8.08626 4C7.19611 4 6.35789 4.23746 5.62804 4.65439C4.06148 5.54462 3 7.26056 3 9.24232C3 9.81001 3.08941 10.3491 3.25153 10.8593C4.12155 14.9013 9.69287 20 12.0034 20C14.2502 20 19.875 14.9013 20.7488 10.8593C20.9109 10.3491 21 9.81001 21 9.24232C21.0007 7.26056 19.9383 5.54462 18.3721 4.65439Z" fill="black"/>
        </svg>
    </span> Save</button>

{% endblock %} {% endcomment %}

{% block content %}

<!--begin::Container-->
<div id="kt_content_container" class="container-xxl">
	<div class="row">
		<div class="col-lg-3 mb-5">
            <div class="card card-flush shadow-sm">
                {% comment %} <div class="card-header">
                    <h3 class="card-title">Contact</h3>
                </div> {% endcomment %}
                <div class="card-body">
                    <div class="d-flex flex-column align-items-center my-5">
                        <!--begin::Avatar-->
                        {% comment %}
                        <div class="symbol symbol-circle symbol-70px">
                            <img alt="Logo" src="{% static 'common/assets/media/avatars/150-26.jpg' %}" />
                        </div>
                        {% endcomment %}

                        <div class="symbol symbol-circle symbol-70px">
                            <a><div class="symbol-label fs-2 bg-warning text-light">{{ lead.author.first_name|make_list|first }}{{ lead.author.last_name|make_list|first }}</div></a>
                        </div>
                        <!--end::Avatar-->
                    </div>

                    <div class="d-flex flex-column align-items-center mb-5">
                        <div class="fw-bolder fs-4">{{ lead.author.first_name }} {{ lead.author.last_name }}</div>
                        <div>{% if lead.author_type == 'broker' %}<span class="badge badge-info fs-9">Agent</span>{% elif lead.author_type == 'direct' %}<span class="badge badge-dark fs-9">Direct</span>{% endif %}</div>
                    </div>

                    <div class="fs-6 my-5">
                        <div class="fw-bolder mt-5">Country</div>
                        <div class="text-gray-600">{{ lead.author.country_from_phone_number.name }}</div>
                        {% comment %} <div class="fw-bolder mt-5">Language</div>
                        <div class="text-gray-600">{{ lead.author.languages_string|title }}</div> {% endcomment %}
                    </div>

                    <form action="{% url 'leads:detail' lead.uuid %}" method="POST">
                    {% csrf_token %}

                    <div class="d-flex flex-column align-items-center mt-5">
                        <!-- TODO: put a 140 character limit -->
                        <textarea class="form-control" rows="3" placeholder="Enter message" data-kt-autosize="true" {% if has_contacted and not is_connected %}disabled{% endif %}></textarea>
                    </div>

                    <!-- TODO: integrate ReCaptcha 3, it doesn't have any UI -->
                    <!-- block UI https://preview.keenthemes.com/metronic8/demo1/documentation/general/blockui.html -->

                    {% has_contacted request.user.user lead as has_contacted %}
                    {% is_connected request.user.user lead as is_connected %}
                    <div class="d-flex flex-column align-items-center mt-5">
                        <button class="btn btn-sm btn-success col-12" {% if has_contacted and not is_connected %}disabled{% endif %}>WhatsApp</button>
                        <span class="mt-2">We'll send you the user's WhatsApp contact when the user has agreed to connect with you.</span>
                    </div>
                    <!--begin::Error message-->
                    <div class="text-danger mt-3">{% if form.message.errors %}{% for error in form.message.errors %}{{ error|escape }}{% if forloop.last %} {% endif %}{% endfor %}{% endif %}</div>
                    <!--end::Error message-->

                    </form>
                </div>
            </div>
		</div>

        <div class="col-lg-9 mb-5">

            <div class="card card-flush shadow-sm mb-8">
                <div class="card-header ribbon ribbon-top">
                    {% if lead.lead_type == 'buying' %}
                        <div class="ribbon-label bg-success">Buying</div>
                    {% elif lead.lead_type == 'selling' %}
                        <div class="ribbon-label bg-danger">Selling</div>
                    {% endif %}
                    <h3 class="card-title mt-10">{{ lead.title }}</h3>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-xl-3 mb-3">
                            <div class="fw-bolder">Commission %</div>
                            <div class="text-gray-600 mb-2">{{ lead.commission_pct }}%</div>
                        </div>
                        <div class="col-xl-3 mb-3">
                            <div class="fw-bolder">Commission Payable After</div>
                            <div class="text-gray-600 mb-2">{{ lead.get_commission_payable_after_display|title }}</div>
                        </div>
                        <!-- 120 char -->
                        <div class="col-xl-6 mb-3">
                            <div class="fw-bolder">Other Commission Details</div>
                            <div class="text-gray-600 mb-2">{{ lead.other_commission_details }}</div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xl-3 mb-3">
                            <div class="fw-bolder">{% if lead.lead_type == 'buying' %}Destination{% elif lead.lead_type == 'selling' %}Source{% endif %} Country</div>
                            <div class="text-gray-600 mb-2">{{ lead.country.name }}</div>
                        </div>
                    </div>
                    <div>
                        {{ lead.details }}
                    </div>
                </div>
            </div>

            <!--begin::Photos and documents toolbar-->
            <div class="d-flex flex-wrap flex-stack mx-4 mb-3">
                <!--begin::Title-->
                <h3 class="fw-bolder">Photos & Documents</h3>
                <!--end::Title-->
            </div>
            <!--end::Photos and documents toolbar-->

            <div class="row">
                {% for file in lead.files.all %}
                    {% if 'pdf' not in file.file_type %}
                        <div class="col-lg-4 col-md-6 mb-5">
                            <div class="card overlay overflow-hidden">
                                <div class="card-body p-0">
                                    <a href="{% url 'files:get_file' file.uuid %}"><img src="{% url "files:get_file" file.uuid %}" style="object-fit: cover; height: 200px" class="w-300px rounded" /></a>
                                </div>
                            </div>
                        </div>
                    {% else %}
                        <div class="col-lg-4 col-md-6 mb-5">
                            <!--begin::Card-->
                            <div class="card h-100">
                                <!--begin::Card body-->
                                <div class="card-body d-flex justify-content-center text-center flex-column p-8">
                                    <!--begin::Name-->
                                    <a href="{% url 'files:get_file' file.uuid %}" class="text-gray-800 text-hover-primary d-flex flex-column">
                                        <!--begin::Image-->
                                        <div class="symbol symbol-60px mb-5">
                                            <img src="{% static 'common/assets/media/svg/files/pdf.svg' %}" alt="" />
                                        </div>
                                        <!--end::Image-->
                                        <!--begin::Title-->
                                        <div class="fs-5 fw-bolder mb-2">{{ file.filename|slice:':80' }}{% if lead.filename > 80 %}...{% endif %}</div>
                                        <!--end::Title-->
                                    </a>
                                    <!--end::Name-->
                                </div>
                                <!--end::Card body-->
                            </div>
                            <!--end::Card-->
                        </div>
                    {% endif %}
                {% endfor %}
            </div>
		</div>
	</div>
</div>
<!--end::Container-->

{% endblock %}

{% block page_custom_script %}
<script src="https://www.google.com/recaptcha/api.js"></script>
{% endblock %}