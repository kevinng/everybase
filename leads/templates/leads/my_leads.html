{% extends 'extendables/b.html' %}

{% load static %}

{% block page_title %}My Leads{% endblock %}

{% block page_subtitle %}
<ul class="breadcrumb breadcrumb-separatorless fw-bold fs-7 my-1">
    <li class="breadcrumb-item text-muted">Me</li>
    <li class="breadcrumb-item">
        <span class="bullet bg-gray-300 w-5px h-2px"></span>
    </li>
    <li class="breadcrumb-item text-dark">My Leads</li>
</ul>
{% endblock %}

{% block actions %}
{% include 'leads/includes/toolbar_actions.html' %}
{% endblock %}

{% block content_body %}
<div class="post d-flex flex-column-fluid" id="kt_post">
    <div id="kt_content_container" class="container-xxl">

        {% include 'relationships/includes/has_incomplete_profile.html' %}
        
        <div class="card mb-5 mb-xl-10 shadow-sm">
            <div class="card-body pt-9 pb-0">
                {% include 'leads/includes/user_item.html' %}
                {% include 'leads/includes/user_profile_nav.html' with tab='my_leads' %}
            </div>
        </div>

        {% if page_obj|length > 0 %}
            {% for lead in page_obj %}
                {% include 'leads/includes/lead_item.html' with lead=lead %}
            {% endfor %}
        {% else %}
            <div class="card shadow-sm">
                <div class="card-body text-center">
                    <div class="fs-4 fw-bold">You've not posted any leads.</div>
                    <div class="mt-4"><a href="{% url 'leads:lead_create' %}" class="btn btn-primary">Post Lead</a></div>
                </div>
            </div>
        {% endif %}
    </div>
</div>

{% include 'includes/paginator.html' %}
{% endblock %}

{% block page_custom_javascript %}
{% comment %}
Code to render the clipboard Javascript for each lead item after the Javascripts dependencies have been imported.
We cannot minify this code, even if we use replacement tokens, because the minifier assumes there's only 1 instance of this code, and replace the tokened-code in minification.
We minify the code manually by removing all newlines and spaces, preserving ';'.

$(document).ready(function() {
    // Select elements
    const lead_{{ lead.id }}_target = document.getElementById('lead_{{ lead.id }}_clipboard');
    const lead_{{ lead.id }}_button = lead_{{ lead.id }}_target.nextElementSibling;

    // Init clipboard -- for more info, please read the offical documentation: https://clipboardjs.com/
    var lead_{{ lead.id }}_clipboard = new ClipboardJS(lead_{{ lead.id }}_button, {
        target: lead_{{ lead.id }}_target,
        text: function() {
            return lead_{{ lead.id }}_target.value;
        }
    });

    // Success action handler
    lead_{{ lead.id }}_clipboard.on('success', function(e) {
        const currentLabel = lead_{{ lead.id }}_button.innerHTML;

        // Exit label update when already in progress
        if(lead_{{ lead.id }}_button.innerHTML === 'Copied!'){
            return;
        }

        // Update button label
        lead_{{ lead.id }}_button.innerHTML = 'Copied!';

        // Revert button label after 3 seconds
        setTimeout(function(){
            lead_{{ lead.id }}_button.innerHTML = currentLabel;
        }, 3000)
    });

})
{% endcomment %}
{% for lead in request.user.user.leads_with_author.all %}
<script>
$(document).ready(function() {const lead_{{ lead.id }}_target=document.getElementById('lead_{{ lead.id }}_clipboard');const lead_{{ lead.id }}_button=lead_{{ lead.id }}_target.nextElementSibling;var lead_{{ lead.id }}_clipboard=new ClipboardJS(lead_{{ lead.id }}_button, {target:lead_{{ lead.id }}_target,text:function(){return lead_{{ lead.id }}_target.value;}});lead_{{ lead.id }}_clipboard.on('success',function(e){const currentLabel=lead_{{ lead.id }}_button.innerHTML;if(lead_{{ lead.id }}_button.innerHTML==='Copied!'){return;}lead_{{ lead.id }}_button.innerHTML = 'Copied!';setTimeout(function(){lead_{{ lead.id }}_button.innerHTML=currentLabel;},3000)});})
</script>
{% endfor %}
{% endblock %}