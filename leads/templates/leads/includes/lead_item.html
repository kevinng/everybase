{% comment %}
Parameters:
    lead, lead item to be rendered
{% endcomment %}

{% load static %}

<div class="card shadow-sm mt-4">
    <div class="card-header">
        <div class="card-title align-items-start flex-column">
            <div class="d-flex align-items-center">
                <div class="symbol symbol-45px me-5">
                    {% include 'leads/includes/avatar.html' with user=lead.author %}
                </div>
                <div class="d-flex justify-content-start flex-column">
                    {% include 'leads/includes/avatar_details.html' with user=lead.author %}
                </div>
            </div>
        </div>
        <div class="card-toolbar">
            <span class="text-muted">{{ lead.age_desc }}</span>
        </div>
    </div>

    <div class="card-body">
        <div class="text-dark">
            {% comment %} Note: preview has no line breaks {% endcomment %}
            <div class="lead_body_preview">{{ lead.body|truncatechars:50 }}{% if lead.body|length > 50 %} <span class="text-primary cursor-pointer show_more_lead_body">Show More</span>{% endif %}</div>
            <div class="lead_body">{{ lead.body|linebreaks }}</div>
        </div>
        <div class="d-flex justify-content-between mt-2">
            <div>
                {% include 'leads/includes/lead_badges.html' with lead=lead %}
            </div>
            <div>
                <span class="badge badge-light" data-bs-toggle="tooltip" data-bs-placement="bottom"{% if request.user.is_authenticated and request.user.user.id == lead.author.id %} title="{% include 'leads/includes/tooltips/leads/x_users_contacted_you.txt' with count=lead.num_contacts %}"{% else %}title="{% include 'leads/includes/tooltips/leads/x_users_contacted_author.txt' with count=lead.num_contacts %}"{% endif %}>{{ lead.num_contacts }} Contacts</span>
            </div>
        </div>
    </div>

    <div class="card-footer">
        <div class="d-flex justify-content-between">
            <div>
                {% if not request.user.is_authenticated or request.user.user.id != lead.author.id %}
                    {% load has_flagged_spam %}
                    {% has_flagged_spam request lead as has_flagged_spam %}
                    <button type="button" id="flag_spam_button__{{lead.id}}" onclick="flag_lead({{lead.id}}, 'spam', 'flag_spam_button__{{lead.id}}', 'flag_spam_badge__{{lead.id}}')" class="btn {% if has_flagged_spam %}btn-warning{% else %}text-warning{% endif %} btn-sm" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Mark as spam to help other users.">Spam <span id="flag_spam_badge__{{lead.id}}" class="badge badge-warning ms-1">{{ lead.num_spam_flags }}</span></button>

                    {% load has_flagged_scam %}
                    {% has_flagged_scam request lead as has_flagged_scam %}
                    <button type="button" id="flag_scam_button__{{lead.id}}" onclick="flag_lead({{lead.id}}, 'scam', 'flag_scam_button__{{lead.id}}', 'flag_scam_badge__{{lead.id}}')" class="btn {% if has_flagged_scam %}btn-danger{% else %}text-danger{% endif %} btn-sm ms-1" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Mark as scam to help other users.">Scam <span id="flag_scam_badge__{{lead.id}}" class="badge badge-danger ms-1">{{ lead.num_scam_flags }}</span></button>

                    {% comment %} <a href="#" class="btn btn-light-danger btn-sm"><i class="bi bi-hand-thumbs-down"></i> Bad <span class="badge badge-danger ms-1">2</span></a> {% endcomment %}
                    {% comment %} <a href="#" class="btn btn-active-light-danger btn-sm text-danger ms-2"><i class="bi text-danger bi-hand-thumbs-down"></i> Spam or Scam <span class="badge badge-danger ms-1">2</span></a> {% endcomment %}
                    {% comment %} <a href="#" class="btn btn-outline btn-outline-dashed btn-outline-danger btn-active-light-danger btn-sm ms-1">Scam <span class="badge badge-danger ms-1">2</span></a> {% endcomment %}
                    {% comment %} <a href="#" class="btn btn-outline btn-outline-dashed btn-outline-warning btn-active-light-warning btn-sm">Spam <span class="badge badge-warning ms-1">5</span></a> {% endcomment %}
                {% endif %}
            </div>
            {% if request.user.is_authenticated and request.user.user is not None and request.user.user.id == lead.author.id %}
                <a href="{% url 'leads:lead_detail' lead.id %}" class="btn btn-light-info btn-sm">Details</a>
            {% else %}

            <div>
                <a target="_blank" href="{% url 'leads:contact_lead' lead.id %}" class="btn btn-primary btn-sm">Contact</a>
                {% comment %} <span class="bg-light text-muted btn-sm fw-bold" data-bs-toggle="tooltip" data-bs-placement="bottom" title="You've contacted this user.">Contacted</span> {% endcomment %}
            </div>
                
            {% endif %}
        </div>
    </div>
</div>