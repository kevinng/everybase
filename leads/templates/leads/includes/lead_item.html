{% comment %} 
Params:
    lead, lead to display
    more_css_classes, additional div CSS classes

Note: thumbnails are not clickable.
{% endcomment %}

<a href="{% url 'leads:lead_detail' lead.slug_link %}">
    <div class="bg-white hover:outline hover:outline-1 hover:outline-blue-500 shadow-md rounded{% if more_css_classes|cut:' ' != '' %} {{ more_css_classes }}{% endif %}">

        <div class="flex justify-between bg-blue-50 w-full px-8 py-4">
            <div class="flex flex-col justify-start items-start">
                <div class="text-sm font-semibold">{{ lead.author.first_name|title }} {{ lead.author.last_name|title }}</div>
                {% if lead.author.country and lead.author.country.name|cut:' ' != '' %}
                    <div class="text-sm">{{ lead.author.country.name }}</div>
                {% endif %}
                {% if lead.author.company_name and lead.author.company_name|cut:' ' != '' %}
                    <div class="text-sm">{{ lead.author.company_name }}</div>
                {% endif %}
            </div>
        </div>

        <div class="px-8 pb-8 flex justify-between items-start">
            <div>
                {% comment %} start: lead_type, author_type {% endcomment %}
                <div class="mt-4">{% if lead.lead_type == 'buying' %}Buying{% elif lead.lead_type == 'selling' %}Selling{% endif %}, {% if lead.author_type == 'direct' %}Direct {% if lead.lead_type == 'buying' %}Buyer{% elif lead.lead_type == 'selling' %}Seller{% endif %}{% elif lead.author_type == 'broker' %}Middleman{% endif %}</div>
                {% comment %} end: lead_type, author_type {% endcomment %}

                {% comment %} start: buy_country, sell_country {% endcomment %}
                <div class="text-sm">From {% if lead.buy_country is not None %}{{ lead.buy_country.name }}{% else %}any country{% endif %} to {% if lead.sell_country is not None %}{{ lead.sell_country.name }}{% else %}any country{% endif %}</div>
                {% comment %} end: buy_country, sell_country {% endcomment %}

                {% comment %} start: comments, comments from you {% endcomment %}
                {% load has_saved_lead %}
                {% has_saved_lead user.user lead as has_saved_lead %}
                <div class="text-sm">{{ lead.num_comments }} comments{% if request.user.is_authenticated %}{% load num_lead_comments_by %}{% num_lead_comments_by lead request.user.user as num_lead_comments_by %}{% if num_lead_comments_by > 0 %}, {{ num_lead_comments_by }} by you{% endif %}{% endif %}{% if has_saved_lead %}, saved{% endif %}</div>
                {% comment %} end: comments, comments from you {% endcomment %}

                {% comment %} start: thumbnails {% endcomment %}
                {% if lead.display_images.all|length > 0 %}
                    <div class="flex items-start justify-start mt-4 gap-2">
                        {% load thumbnail_url %}
                        {% for file in lead.display_images.all %}
                            {% thumbnail_url file as thumbnail_url %}
                            <img src="{{ thumbnail_url }}" class="shadow-md">
                        {% endfor %}
                    </div>
                {% endif %}
                {% comment %} end: thumbnails {% endcomment %}
                
                {% comment %} start: need_agent, need_logistics_agent {% endcomment %}
                {% if lead.need_agent or lead.need_logistics_agent %}
                <div class="italic mt-4">Need {% if lead.need_agent %}{% if lead.lead_type == 'buying' %}buying{% elif lead.lead_type == 'selling' %}selling{% endif %} agent{% if lead.need_logistics_agent %}, logistics agent{% endif %}{% endif %}</div>
                {% endif %}
                {% comment %} end: need_agent, need_logistics_agent {% endcomment %}

                {% comment %} start: details {% endcomment %}
                <div class="mt-2">{{ lead.details|linebreaksbr|truncatechars:140 }}{% if lead.details|length > 140 %}...{% endif %}</div>
                {% comment %} end: details {% endcomment %}

                {% if commission_type and commission_type == 'percentage' or min_commission and min_commission|cut:' ' != '' or max_commission and max_commission|cut:' ' != '' %}
                    {% if lead.commission %}
                        {% comment %} start: commission {% endcomment %}
                        <div class="font-bold text-slate-400 mt-4">Agent Commission</div>
                        <div class="mt-1">{{ lead.commission }} % of Sales</div>
                        {% comment %} end: commission {% endcomment %}
                    {% endif %}
                {% endif %}

                {% if min_avg_deal and min_avg_deal|cut:' ' != '' or max_avg_deal and max_avg_deal|cut:' ' != '' %}
                    {% if lead.avg_deal_size %}
                        {% comment %} start: avg_deal_size {% endcomment %}
                        <div class="font-bold text-slate-400 mt-4">Average Deal Size</div>
                        <div class="mt-1">USD {{ lead.avg_deal_size|floatformat:2 }}</div>
                        {% comment %} end: avg_deal_size {% endcomment %}
                    {% endif %}
                {% endif %}

                {% if commission_payable_after and commission_payable_after|cut:' ' != '' and commission_payable_after != 'all' or commission_payable_after_other and commission_payable_after_other|cut:' ' != ''  %}
                    {% if lead.commission_payable_after %}
                        {% comment %} start: commission_payable_after {% endcomment %}
                        <div class="font-bold text-slate-400 mt-4">Commission Payable After</div>
                        <div class="mt-1">{% if lead.commission_payable_after == 'initial_deposit_received' %}Initial Deposit Received{% elif lead.commission_payable_after == 'goods_shipped' %}Goods Shipped{% elif lead.commission_payable_after == 'buyer_received_goods_services' %}Buyer Received Goods/Services{% elif lead.commission_payable_after == 'full_payment_received' %}Full Payment Received{% elif lead.commission_payable_after == 'other' %}{{ lead.commission_payable_after_other|linebreaksbr|truncatechars:140 }}{% if lead.commission_payable_after_other|length > 140 %}...{% endif %}{% endif %}</div>
                        {% comment %} end: commission_payable_after {% endcomment %}
                    {% endif %}
                {% endif %}

                {% comment %} start: other_agent_details {% endcomment %}
                {% if other_agent_details and other_agent_details|cut:' ' != '' %}
                    <div class="font-bold text-slate-400 mt-4">Other Details For {% if lead.lead_type == 'selling' %}Selling{% elif lead.lead_type == 'buying' %}Buying{% endif %} Agent</div>
                    <div class="mt-1 break-words">{{ lead.other_agent_details|linebreaksbr|truncatechars:140 }}{% if lead.other_agent_details|length > 140 %}...{% endif %}</div>
                {% endif %}
                {% comment %} end: other_agent_details {% endcomment %}

                {% comment %} start: comm_negotiable {% endcomment %}
                {% if comm_negotiable and comm_negotiable == 'negotiable' %}
                    <div class="italic mt-4">Commission may differ and is negotiable for each deal.</div>
                {% endif %}
                {% comment %} end: comm_negotiable {% endcomment %}

                {% if need_logistics_agent and need_logistics_agent == 'on' %}
                    <div class="font-bold mt-6">I need logistics agents</div>

                    {% comment %} start: lead.other_logistics_agent_details {% endcomment %}
                    <div class="font-bold text-slate-400 mt-4">Logistics Needs</div>
                    <div class="mt-1 break-words">{{ lead.other_logistics_agent_details|linebreaksbr|truncatechars:140 }}{% if lead.other_logistics_agent_details|length %}...{% endif %}</div>
                    {% comment %} end: lead.other_logistics_agent_details {% endcomment %}
                {% endif %}
            </div>

            <div class="text-sm mt-4 whitespace-nowrap">{{ lead.age_desc }}</div>
        </div>
    </div>
</a>