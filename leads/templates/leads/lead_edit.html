{% extends 'extendables/b.html' %}

{% load static %}

{% block title %}Edit I-Need-Agent Post{% endblock %}

{% block other_css %}
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
{% endblock %}

{% block content %}
<form action="{% url 'leads:lead_edit' lead_pk %}" method="post">
{% csrf_token %}
<div class="flex justify-center">

UPDATE THIS PAGE TO LOOK LIKE THE CREATE PAGE

    <div class="bg-white max-w-md mt-10 lg:rounded-lg p-10 shadow-md">
        <div class="text-center mt-6">Edit Post</div>
        <h1 class="text-3xl font-bold text-center">I-Need-Agent</h1>
        <div class="mt-7 flex flex-col justify-center">
            <label for="lead_type" class="text-sm font-bold uppercase text-slate-400">I Want To</label>
            <div class="mt-2">
                <select id="i_want_to" name="lead_type" class="select2">
                    <option value="selling"{% if form.lead_type.value == 'selling' %} selected{% endif %}>Sell</option>
                    <option value="buying"{% if form.lead_type.value == 'buying' %} selected{% endif %}>Buy</option>
                </select>
            </div>
            {% if form.lead_type.errors %}<div class="px-1 mt-2 text-red-500">{% for error in form.lead_type.errors %}{{ error|escape }}{% if not forloop.last %} {% endif %}{% endfor %}</div>{% endif %}

            <label id="buy_label" for="buy_country" class="text-sm font-bold uppercase text-slate-400 mt-5">Source Country</label>
            <div class="mt-2">
                <select id="buy_country" name="buy_country" class="select2" data-placeholder="Choose country">
                    <option></option>
                    <option id="buy_country_any" value="any_country"{% if form.buy_country.value == 'any_country' %} selected{% endif %}>Any Country</option>
                    {% for country in countries %}
                        <option value="{{ country.programmatic_key }}"{% if form.buy_country.value == country.programmatic_key %} selected{% endif %}>{{ country.name }}</option>
                    {% endfor %}
                </select>
            </div>
            {% if form.buy_country.errors %}<div class="px-1 mt-2 text-red-500">{% for error in form.buy_country.errors %}{{ error|escape }}{% if not forloop.last %} {% endif %}{% endfor %}</div>{% endif %}

            <label id="sell_label" for="sell_country" class="text-sm font-bold uppercase text-slate-400 mt-5">Sell To This Country</label>
            <div class="mt-2">
                <select id="sell_country" name="sell_country" class="select2" data-placeholder="Choose country">
                    <option></option>
                    <option id="sell_country_any" value="any_country"{% if form.sell_country.value == 'any_country' %} selected{% endif %}>Any Country</option>
                    {% for country in countries %}
                        <option value="{{ country.programmatic_key }}"{% if form.sell_country.value == country.programmatic_key %} selected{% endif %}>{{ country.name }}</option>
                    {% endfor %}
                </select>
            </div>
            {% if form.sell_country.errors %}<div class="px-1 mt-2 text-red-500">{% for error in form.sell_country.errors %}{{ error|escape }}{% if not forloop.last %} {% endif %}{% endfor %}</div>{% endif %}

            <label for="avg_deal_size" class="text-sm font-bold uppercase text-slate-400 mt-5">Average Deal Size</label>
            <div class="flex items-center justify-start">
                <div class="mr-3 font-bold text-2xl">USD</div><input name="avg_deal_size" placeholder="0" type="number" value="{{ form.avg_deal_size.value }}" class="w-1/2 border rounded-md py-3 px-5 mt-2">
            </div>
            {% if form.avg_deal_size.errors %}<div class="px-1 mt-2 text-red-500">{% for error in form.avg_deal_size.errors %}{{ error|escape }}{% if not forloop.last %} {% endif %}{% endfor %}</div>{% endif %}

            <label for="commissions" class="text-sm font-bold uppercase text-slate-400 mt-5">Average Agent Commission</label>
            <div class="flex items-center justify-start">
                <input name="commissions" placeholder="0" type="number" value="{{ form.commissions.value }}" class="w-1/2 border rounded-md py-3 px-5 mt-2 mr-3"><div class="font-bold text-2xl">%</div>
            </div>
            {% if form.commissions.errors %}<div class="px-1 mt-2 text-red-500">{% for error in form.commissions.errors %}{{ error|escape }}{% if not forloop.last %} {% endif %}{% endfor %}</div>{% endif %}

            <div class="mt-4">This is a guide only - actual commissions negotiated per deal.</div>

            <label for="details" class="text-sm font-bold uppercase text-slate-400 mt-4">Details</label>
            <textarea name="details" rows="4" type="text" class="w-full border rounded-md py-3 px-5 mt-2">{% if form.details.value is not None and form.details.value|cut:' ' != '' %}{{ form.details.value }}{% endif %}</textarea>
            {% if form.details.errors %}<div class="px-1 mt-2 text-red-500">{% for error in form.details.errors %}{{ error|escape }}{% if not forloop.last %} {% endif %}{% endfor %}</div>{% endif %}

            <label for="other_comm_details" class="text-sm font-bold uppercase text-slate-400 mt-4">Other Commission Details</label>
            <textarea name="other_comm_details" rows="4" type="text" class="w-full border rounded-md py-3 px-5 mt-2">{% if form.other_comm_details.value is not None %}{{ form.other_comm_details.value }}{% endif %}</textarea>
            <div class="mt-2">Other details regarding commission</div>
            {% if form.other_comm_details.errors %}<div class="px-1 mt-2 text-red-500">{% for error in form.other_comm_details.errors %}{{ error|escape }}{% if not forloop.last %} {% endif %}{% endfor %}</div>{% endif %}

            <button type="submit" class="py-3 px-7 rounded-lg text-white bg-blue-500 hover:bg-blue-600 mt-6 shadow-md">Post</button>
        </div>
    </div>
</div>
</form>
{% endblock %}

{% comment %}
Unrendered Javascript. We put the in an unrendered block so we can take advantage of the code editor's code highlighting feature.

Minifiers:
https://www.minifier.org/
https://codebeautify.org/minify-js
{% endcomment %}
{% block unrendered_javascript %}
<script>
$(document).ready(function() {
    $('.select2').select2();

    $('.select2').one('select2:open', function(e) {
        $('input.select2-search__field').prop('placeholder', 'Search here...');
    });

    update_country_labels = function (choice) {
        console.log($('#buy_country option:selected').val())
        console.log($('#sell_country option:selected').val())
        if (choice == 'buying') {
            $('#buy_label').text('Buy From This Country');
            $('#sell_label').text('Destination Country');
            $('#buy_country_any').attr('disabled', false); // I can buy from any country
            $('#sell_country_any').attr('disabled', true); // My destination cannot be any
            if ($('#sell_country option:selected').val() == 'any_country') {
                // If my destination is any, empty it
                $('#sell_country').val(null).trigger('change');
            }
        } else if (choice == 'selling') {
            $('#buy_label').text('Source Country');
            $('#sell_label').text('Sell To This Country');
            $('#buy_country_any').attr('disabled', true); // My source cannot be any
            $('#sell_country_any').attr('disabled', false); // I can sell to any country
            if ($('#buy_country option:selected').val() == 'any_country') {
                // If my source is any, empty it
                $('#buy_country').val(null).trigger('change');
            }
        }
    }

    update_country_labels($('#i_want_to').val())

    $('#i_want_to').change(function() {
        choice = $(this).val();
        update_country_labels(choice);
    });
});
</script>
{% endblock %}
{% block other_script %}
<script src="https://code.jquery.com/jquery-3.6.0.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<script>  
$(document).ready((function(){$(".select2").select2(),$(".select2").one("select2:open",(function(e){$("input.select2-search__field").prop("placeholder","Search here...")})),update_country_labels=function(e){console.log($("#buy_country option:selected").val()),console.log($("#sell_country option:selected").val()),"buying"==e?($("#buy_label").text("Buy From This Country"),$("#sell_label").text("Destination Country"),$("#buy_country_any").attr("disabled",!1),$("#sell_country_any").attr("disabled",!0),"any_country"==$("#sell_country option:selected").val()&&$("#sell_country").val(null).trigger("change")):"selling"==e&&($("#buy_label").text("Source Country"),$("#sell_label").text("Sell To This Country"),$("#buy_country_any").attr("disabled",!0),$("#sell_country_any").attr("disabled",!1),"any_country"==$("#buy_country option:selected").val()&&$("#buy_country").val(null).trigger("change"))},update_country_labels($("#i_want_to").val()),$("#i_want_to").change((function(){choice=$(this).val(),update_country_labels(choice)}))}));
</script>
{% endblock %}