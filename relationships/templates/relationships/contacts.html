{% extends 'extendables/b.html' %}

{% load static %}

{% block page_title %}Contacts{% endblock %}

{% block page_subtitle %}Persons you've contacted{% endblock %}

{% block actions %}
{% include 'leads/includes/toolbar_actions.html' with hide_search=True %}
{% endblock %}

{% block content_body %}
<div class="post d-flex flex-column-fluid">
    <div id="kt_content_container" class="container-xxl">

        {% include 'relationships/includes/has_incomplete_profile.html' %}

        {% comment %} Start: Search options {% endcomment %}
        <form id="search_form" action="{% url 'home' %}" method="get">
        <input type="hidden" id="device_id" name="device_id" value=""/>
        <div>


            <div class="d-flex justify-content-between align-items-center mt-2">
                <div>
                    {% if show_reset is True %}<a href="{% url 'home' %}" class="btn btn-sm btn-outline btn-outline-primary text-hover-white me-2">Reset</a>{% endif %}
                    <span class="text-dark fw-bolder"><span data-kt-countup="true" data-kt-countup-value="{{ page_obj.paginator.count }}">0</span> persons</span>
                </div>

            </div>

            {% comment %} Start: Options to show on/above large {% endcomment %}
            <div class="separator my-2"></div>

            <div class="d-flex align-items-center">
                <div class="form-check form-check-custom">
                    <input class="form-check-input me-2" type="checkbox" name="sm_sourcing_agent" id="sm_sourcing_agent" {% if sourcing_agent == 'on' %}checked {% endif %}/>
                    <label for="sm_sourcing_agent">
                        <span class="badge badge-success" data-bs-toggle="tooltip" data-bs-placement="bottom" title="{% include 'leads/includes/tooltips/leads/sourcing_agent.txt' %}">Will Work With This User</span>
                    </label>
                </div>
            </div>

            <div class="d-flex align-items-center mt-2">
                <div class="form-check form-check-custom">
                    <input class="form-check-input me-2" type="checkbox" name="sm_sales_agent" id="sm_sales_agent" {% if sales_agent == 'on' %}checked {% endif %}/>
                    <label for="sm_sales_agent">
                        <span class="badge badge-danger" data-bs-toggle="tooltip" data-bs-placement="bottom" title="{% include 'leads/includes/tooltips/leads/sourcing_agent.txt' %}">Will Not Work With This User</span>
                    </label>
                </div>
            </div>

            <div class="d-flex align-items-center mt-2">
                <div class="form-check form-check-custom">
                    <input class="form-check-input me-2" type="checkbox" name="sm_sales_agent" id="sm_sales_agent" {% if sales_agent == 'on' %}checked {% endif %}/>
                    <label for="sm_sales_agent">
                        <span class="badge badge-secondary" data-bs-toggle="tooltip" data-bs-placement="bottom" title="{% include 'leads/includes/tooltips/leads/sourcing_agent.txt' %}">No Review</span>
                    </label>
                </div>
            </div>
            
            {% comment %} <div class="separator my-2"></div>

            <div class="d-flex align-items-center">
                <div class="col-lg-6 col-12">
                    <label for="origin_countries" class="form-label">Origin Countries</label>
                    <select class="form-select" data-control="select2" data-placeholder="Filter Origin Countries" name="origin_countries" id="origin_countries" data-allow-clear="true" multiple="multiple">
                        <option></option>
                        {% for country in countries %}
                            <option value="{{ country.programmatic_key }}"{% if form.origin_country.value == country.programmatic_key %} selected{% endif %}>{{ country.name }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>

            <div class="separator my-2"></div>

            <div class="d-flex align-items-center">
                <div class="col-lg-6 col-12">
                    <label for="destination_countries" class="form-label">Destination Countries</label>
                    <select class="form-select" data-control="select2" data-placeholder="Filter Destination Countries" name="destination_countries" id="destination_countries" data-allow-clear="true" multiple="multiple">
                        <option></option>
                        {% for country in countries %}
                            <option value="{{ country.programmatic_key }}"{% if form.destination_country.value == country.programmatic_key %} selected{% endif %}>{{ country.name }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div> {% endcomment %}
        </div>
        </form>
        {% comment %} End: Search options {% endcomment %}

        {% comment %} {% if page_obj|length > 0 %}
            {% for lead in page_obj %} {% endcomment %}
                {% comment %} {% include 'leads/includes/lead_item.html' with lead=lead %} {% endcomment %}



                {% comment %} <a href="#"> {% endcomment %}
                    <div class="card shadow-sm mt-4">
                        <div class="card-header my-3">
                            <div class="card-title align-items-start flex-column">
                                <div class="text-muted fs-7 fw-normal mb-4 d-block d-lg-none">
                                    You contacted user 2d ago
                                </div>
                                <div class="d-flex align-items-top">
                                    <div class="symbol symbol-45px me-5">
                                        <div class="symbol-label fs-3 bg-light-info text-info">KN</div>
                                    </div>
                                    <div class="d-flex justify-content-start flex-column">
                                        <div class="text-dark fw-bolder fs-6">Kevin Ng Kevin Ng Kevin Ng</div>
                                        <div class="fw-bold fs-7">Leng Guan Metal Pte Ltd</div>
                                        <div class="text-muted fw-bold fs-7">United States of America <span class="svg-icon svg-icon-success svg-icon-2" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Verified with phone number country code +{{ user.country.country_code }}">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                                            <rect opacity="0.3" x="2" y="2" width="20" height="20" rx="10" fill="currentColor"/>
                                            <path d="M10.4343 12.4343L8.75 10.75C8.33579 10.3358 7.66421 10.3358 7.25 10.75C6.83579 11.1642 6.83579 11.8358 7.25 12.25L10.2929 15.2929C10.6834 15.6834 11.3166 15.6834 11.7071 15.2929L17.25 9.75C17.6642 9.33579 17.6642 8.66421 17.25 8.25C16.8358 7.83579 16.1642 7.83579 15.75 8.25L11.5657 12.4343C11.2533 12.7467 10.7467 12.7467 10.4343 12.4343Z" fill="currentColor"/>
                                            </svg>
                                        </span></div>
                                        <div class="fw-normal fs-7">I supply medical supplies, resources, etc, etc.</div>
                                    </div>
                                </div>
                            </div>
                            <div class="card-toolbar d-flex align-items-start d-none d-lg-block">
                                <span class="text-muted">User contacted you 2d ago</span>
                            </div>
                        </div>

                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <div class="text-muted fs-7 d-block d-lg-none mb-4">
                                        Status updated 2d ago
                                    </div>
                                    <div class="text-dark">
                                        <div class="lead_body_preview" data-lead-id="{{ lead.id }}">Hello world hello world <span class="text-primary cursor-pointer show_more_lead_body">Show More</span></div>
                                        <div class="lead_body" style="display: none;">{{ lead.body|linebreaks }}</div>
                                    </div>
                                    <div class="d-flex mt-2">
                                        <div>
                                            {% include 'leads/includes/badges/leads/other.html' %}
                                        </div>
                                    </div>
                                </div>
                                <div class="text-muted d-none d-lg-block">
                                    Status updated 2d ago
                                </div>
                            </div>
                            <div class="separator mt-4"></div>
                            <div class="ms-8 mt-4 d-flex justify-content-between">
                                <div>
                                    <div class="text-muted fs-7 d-block d-lg-none mb-4">
                                        You reviewed 2d ago
                                    </div>
                                    <div>This user seems like a scam.</div>
                                    <span class="badge badge-danger mt-2">Will Not Work With This User</span>
                                </div>
                                <div class="text-muted d-none d-lg-block">
                                    You reviewed 2d ago
                                </div>
                            </div>
                        </div>

                        <div class="card-footer">
                            <div class="d-flex justify-content-end">
                                <a href="#" class="btn btn-sm btn-light-info">User Details</a>
                            </div>
                        </div>
                    </div>
                {% comment %} </a> {% endcomment %}

{% comment %} 
                {% if forloop.counter|divisibleby:5 %}
                    <div class="mt-4" align="center">
                        {% include 'includes/adsense_display_ad_unit.html' %}
                    </div>
                {% endif %}
            {% endfor %}
        {% endif %} {% endcomment %}


        <div class="card shadow-sm mt-4">
            <div class="card-header my-3">
                <div class="card-title align-items-start flex-column">
                    <div class="text-muted fs-7 fw-normal mb-4 d-block d-lg-none">
                        You contacted this user 2d ago
                    </div>
                    <div class="d-flex align-items-top">
                        <div class="symbol symbol-45px me-5">
                            <div class="symbol-label fs-3 bg-light-info text-info">KN</div>
                        </div>
                        <div class="d-flex justify-content-start flex-column">
                            <div class="text-dark fw-bolder fs-6">Kevin Ng Kevin Ng Kevin Ng</div>
                            <div class="fw-bold fs-7">Leng Guan Metal Pte Ltd</div>
                            <div class="text-muted fw-bold fs-7">United States of America <span class="svg-icon svg-icon-success svg-icon-2" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Verified with phone number country code +{{ user.country.country_code }}">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                                <rect opacity="0.3" x="2" y="2" width="20" height="20" rx="10" fill="currentColor"/>
                                <path d="M10.4343 12.4343L8.75 10.75C8.33579 10.3358 7.66421 10.3358 7.25 10.75C6.83579 11.1642 6.83579 11.8358 7.25 12.25L10.2929 15.2929C10.6834 15.6834 11.3166 15.6834 11.7071 15.2929L17.25 9.75C17.6642 9.33579 17.6642 8.66421 17.25 8.25C16.8358 7.83579 16.1642 7.83579 15.75 8.25L11.5657 12.4343C11.2533 12.7467 10.7467 12.7467 10.4343 12.4343Z" fill="currentColor"/>
                                </svg>
                            </span></div>
                            <div class="fw-normal fs-7">I supply medical supplies, resources, etc, etc.</div>
                        </div>
                    </div>
                </div>
                <div class="card-toolbar d-flex align-items-start d-none d-lg-block">
                    <span class="text-muted">Contacted 2d ago</span>
                </div>
            </div>

            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <div class="text-muted fs-7 d-block d-lg-none mb-4">
                            Status updated 2d ago
                        </div>
                        <div class="text-dark">
                            <div class="lead_body_preview" data-lead-id="{{ lead.id }}">Hello world hello world <span class="text-primary cursor-pointer show_more_lead_body">Show More</span></div>
                            <div class="lead_body" style="display: none;">{{ lead.body|linebreaks }}</div>
                        </div>
                        <div class="d-flex mt-2">
                            <div>
                                {% include 'leads/includes/badges/leads/other.html' %}
                            </div>
                        </div>
                    </div>
                    <div class="text-muted d-none d-lg-block">
                        Updated 2d ago
                    </div>
                </div>
                {% comment %} <div class="separator mt-4"></div>
                <div class="ms-8 mt-4 d-flex justify-content-between">
                    <div>
                        <span class="badge badge-secondary mt-2">No Review</span>
                    </div>
                </div> {% endcomment %}
            </div>

            <div class="card-footer">
                <div class="d-flex justify-content-end">
                    <a href="#" class="btn btn-sm btn-info">Leave a Review</a>
                </div>
            </div>
        </div>
    </div>
</div>

{% include 'includes/paginator.html' with hide_pages=True %}
{% endblock %}

{% comment %}
$(document).ready(function() {
    // We have two sets of checkboxes to cater for different screensizes, and we want to link them up.

    // Pass Amplitude device to the backend so we can track unauthenticated users.
    device_id = $('#device_id')
    device_id.val(amplitude.getInstance().getDeviceId())

    sourcing = $('#sourcing')
    promoting = $('#promoting')
    need_logistics = $('#need_logistics')
    sourcing_agent = $('#sourcing_agent')
    sales_agent = $('#sales_agent')
    logistics_agent = $('#logistics_agent')
    other = $('#other')

    sm_sourcing = $('#sm_sourcing')
    sm_promoting = $('#sm_promoting')
    sm_need_logistics = $('#sm_need_logistics')
    sm_sourcing_agent = $('#sm_sourcing_agent')
    sm_sales_agent = $('#sm_sales_agent')
    sm_logistics_agent = $('#sm_logistics_agent')
    sm_other = $('#sm_other')

    search_form = $('#search_form')
    reduce_spams_and_scams = $('#reduce_spams_and_scams')
    user_country = $('#user_country')
    user_country_verified = $('#user_country_verified')

    var target = document.querySelector("#search_form")
    var blockUI = new KTBlockUI(target)

    function form_field_changed() {
        search_form.submit()
        blockUI.block()
    }

    function link_and_submit_checkboxes(lg, sm) {
        sm.change(function() {
            lg.prop('checked', this.checked)
            form_field_changed()
        })

        lg.change(function() {
            sm.prop('checked', this.checked)
            form_field_changed()
        })
    }

    link_and_submit_checkboxes(sourcing, sm_sourcing)
    link_and_submit_checkboxes(promoting, sm_promoting)
    link_and_submit_checkboxes(need_logistics, sm_need_logistics)
    link_and_submit_checkboxes(sourcing_agent, sm_sourcing_agent)
    link_and_submit_checkboxes(sales_agent, sm_sales_agent)
    link_and_submit_checkboxes(logistics_agent, sm_logistics_agent)
    link_and_submit_checkboxes(other, sm_other)

    reduce_spams_and_scams.change(function() {
        form_field_changed()
    })

    user_country_verified.change(function() {
        form_field_changed()
    })

    user_country.change(function() {
        form_field_changed()
    })

    via_wechat_id_div = $('#via_wechat_id_div')
    via_wechat = $('#via_wechat')

    function toggle_via_wechat_id_div() {
        if (via_wechat.is(':checked')) {
            via_wechat_id_div.show()
        } else {
            via_wechat_id_div.hide()
        }
    }

    toggle_via_wechat_id_div()

    via_wechat.click(function() {
        toggle_via_wechat_id_div()
    })
})

// These functions are triggered by onclick, and have to be outside document.ready to work.
// This code have to be rendered inline because it has server-side rendered links.

function flag_lead(lead_id, type, button_id, badge_id) {
    url = ''
    if (type == 'spam') {
        url = "{% url 'leads:flag_spam' %}"
    } else if (type == 'scam') {
        url = "{% url 'leads:flag_scam' %}"
    }

    if (url == '') {
        return
    }

    $.post(url,
        {'lead_id': lead_id},
        function(data, status) {
            btn = $('#' + button_id)
            bdg = $('#' + badge_id)
            if (type == 'spam') {
                btn.toggleClass('btn-warning')
                btn.toggleClass('text-warning')
                bdg.html(data['num_spam_flags'])

                amplitude.getInstance().logEvent(
                    'discovery - flagged lead', {
                        'lead id': lead_id,
                        'type': 'spam'
                    }
                )
            } else if (type == 'scam') {
                btn.toggleClass('btn-danger')
                btn.toggleClass('text-danger')
                bdg.html(data['num_scam_flags'])

                amplitude.getInstance().logEvent(
                    'discovery - flagged lead', {
                        'lead id': lead_id,
                        'type': 'scam'
                    }
                )
            }
        }
    )
}
{% endcomment %}
{% block page_custom_javascript %}
{% comment %} <script src="{% static 'leads/js/home.js' %}"></script> {% endcomment %}
{% comment %} <script>$(document).ready((function(){device_id=$("#device_id"),device_id.val(amplitude.getInstance().getDeviceId()),sourcing=$("#sourcing"),promoting=$("#promoting"),need_logistics=$("#need_logistics"),sourcing_agent=$("#sourcing_agent"),sales_agent=$("#sales_agent"),logistics_agent=$("#logistics_agent"),other=$("#other"),sm_sourcing=$("#sm_sourcing"),sm_promoting=$("#sm_promoting"),sm_need_logistics=$("#sm_need_logistics"),sm_sourcing_agent=$("#sm_sourcing_agent"),sm_sales_agent=$("#sm_sales_agent"),sm_logistics_agent=$("#sm_logistics_agent"),sm_other=$("#sm_other"),search_form=$("#search_form"),reduce_spams_and_scams=$("#reduce_spams_and_scams"),user_country=$("#user_country"),user_country_verified=$("#user_country_verified");var e=document.querySelector("#search_form"),s=new KTBlockUI(e);function i(){search_form.submit(),s.block()}function _(e,s){s.change((function(){e.prop("checked",this.checked),i()})),e.change((function(){s.prop("checked",this.checked),i()}))}function c(){via_wechat.is(":checked")?via_wechat_id_div.show():via_wechat_id_div.hide()}_(sourcing,sm_sourcing),_(promoting,sm_promoting),_(need_logistics,sm_need_logistics),_(sourcing_agent,sm_sourcing_agent),_(sales_agent,sm_sales_agent),_(logistics_agent,sm_logistics_agent),_(other,sm_other),reduce_spams_and_scams.change((function(){i()})),user_country_verified.change((function(){i()})),user_country.change((function(){i()})),via_wechat_id_div=$("#via_wechat_id_div"),via_wechat=$("#via_wechat"),c(),via_wechat.click((function(){c()}))}));</script> {% endcomment %}
{% comment %} <script>function flag_lead(a,l,e,t){url="","spam"==l?url="{% url 'leads:flag_spam' %}":"scam"==l&&(url="{% url 'leads:flag_scam' %}"),""!=url&&$.post(url,{lead_id:a},(function(g,s){btn=$("#"+e),bdg=$("#"+t),"spam"==l?(btn.toggleClass("btn-warning"),btn.toggleClass("text-warning"),bdg.html(g.num_spam_flags),amplitude.getInstance().logEvent("discovery - flagged lead",{"lead id":a,type:"spam"})):"scam"==l&&(btn.toggleClass("btn-danger"),btn.toggleClass("text-danger"),bdg.html(g.num_scam_flags),amplitude.getInstance().logEvent("discovery - flagged lead",{"lead id":a,type:"scam"}))}))}</script> {% endcomment %}
{% comment %}
$(document).ready(function() {
    // Hide all lead body
    lead_bodies = $('.lead_body')
    lead_bodies.hide()

    show_more_lead_bodies = $('.show_more_lead_body')
    show_more_lead_bodies.click(function () {
        // Hide button
        $(this).hide()

        // Hide preview and show full lead body
        lead_body_preview = $(this).parent()
        lead_body_preview.siblings('.lead_body').toggle()
        lead_body_preview.toggle()

        lead_id = lead_body_preview.attr("data-lead-id")

        // Log event
        amplitude.getInstance().logEvent('discovery - showed more lead body', { 'lead_id': lead_id })
    })
})
{% endcomment %}
<script src="{% static 'leads/js/lead_item.js' %}"></script>
{% endblock %}