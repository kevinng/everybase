{% extends 'extendables/b.html' %}

{% load static %}

{% block page_title %}Alerts{% endblock %}
{% block page_subtitle %}{% endblock %}

{% block actions %}
{% include 'leads/includes/toolbar_actions.html' with hide_search=True %}
{% endblock %}

{% block content_body %}
<div class="post d-flex flex-column-fluid">
    <div id="kt_content_container" class="container-xxl">
        <div class="alert alert-primary d-flex align-items-center p-5">
            {% comment %} Start: SVG icon: duotune/general/gen045.svg {% endcomment %}
            <span class="svg-icon svg-icon-2hx svg-icon-primary me-3">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect opacity="0.3" x="2" y="2" width="20" height="20" rx="10" fill="currentColor"/>
                    <rect x="11" y="17" width="7" height="2" rx="1" transform="rotate(-90 11 17)" fill="currentColor"/>
                    <rect x="11" y="9" width="2" height="2" rx="1" transform="rotate(-90 11 9)" fill="currentColor"/>
                </svg>
            </span>
            {% comment %} End: SVG icon {% endcomment %}
            <div class="d-flex flex-column">
                <h4 class="text-dark">What's an alert?</h4>
                <div class="mt-1">An alert lets you receive a WhatsApp notification when a user updates requirements and it matches your needs.</div>
                <div class="mt-4">1 notification costs 1 credit.</div>
                <div class="fw-bolder">You have 2 credits left for the month.</div>
                <div>For more credits - upgrade your plan or buy extra credits.</div>
                <div class="mt-2"><a class="btn btn-sm btn-success" href="{% url 'pricing' %}">Upgrade Plan or Buy Extra Credits</a></div>
            </div>
        </div>

        <form action="" method="get">
            <div class="form-check form-check-custom">
                <input class="form-check-input me-2" type="checkbox" name="sm_logistics_agent" id="sm_logistics_agent" {% if logistics_agent == 'on' %}checked {% endif %}/>
                <label for="sm_logistics_agent">Hide Stopped Alerts</label>
            </div>
        </form>

        <div class="card shadow-sm mt-4 bg-info">
            <div class="card-body">
                <h1 class="text-white">You have no alerts set up.</h1>
                
                <a href="" class="btn btn-light-danger mt-4">Create an Alert</a>
            </div>
        </div>

        <div class="card shadow-sm mt-4">
            <div class="card-header pb-3 pt-4">
                <div class="card-title align-items-start flex-column">
                    <button class="btn btn-sm btn-light-danger">Stop</button>
                    {% comment %} <button class="btn btn-sm btn-light-success">Start</button> {% endcomment %}
                </div>
                <div class="card-toolbar d-flex flex-column align-items-end">
                    <div class="badge badge-success">Running</div>
                    <div class="text-muted mt-1">Started 2d ago</div>
                    {% comment %} <span class="text-muted">Last matched 2d ago</span> {% endcomment %}
                    {% comment %} <span class="text-muted">Stopped 2d ago</span> {% endcomment %}
                </div>
            </div>
            <div class="card-body">
                <div>
                    icumsa, Brazil, sugar
                </div>
                <div class="d-flex mt-2">
                    {% include 'leads/includes/badges/leads/other.html' %}
                </div>
                <div class="mt-2">
                    {% comment %} <span class="badge badge-secondary">All Countries</span> {% endcomment %}
                    <span class="badge badge-secondary">Selected Countries</span>
                    <span class="badge badge-secondary">United States of America</span>
                    <span class="badge badge-secondary">United States of America</span>
                    <span class="badge badge-secondary">United States of America</span>
                    <span class="badge badge-secondary">United States of America</span>
                </div>
            </div>
            <div class="card-footer d-flex justify-content-end">
                <a href="" class="btn btn-sm btn-light-info">Contacts (0)</a>
            </div>
        </div>
    </div>
</div>

{% include 'includes/paginator.html' with hide_pages=True %}
{% endblock %}

{% comment %}
$(document).ready(function() {
    // We have two sets of checkboxes to cater for different screensizes, and we want to link them up.

    // Pass Amplitude device to the backend so we can track unauthenticated users.
    device_id = $('#device_id')
    device_id.val(amplitude.getInstance().getDeviceId())

    sourcing = $('#sourcing')
    promoting = $('#promoting')
    need_logistics = $('#need_logistics')
    sourcing_agent = $('#sourcing_agent')
    sales_agent = $('#sales_agent')
    logistics_agent = $('#logistics_agent')
    other = $('#other')

    sm_sourcing = $('#sm_sourcing')
    sm_promoting = $('#sm_promoting')
    sm_need_logistics = $('#sm_need_logistics')
    sm_sourcing_agent = $('#sm_sourcing_agent')
    sm_sales_agent = $('#sm_sales_agent')
    sm_logistics_agent = $('#sm_logistics_agent')
    sm_other = $('#sm_other')

    search_form = $('#search_form')
    reduce_spams_and_scams = $('#reduce_spams_and_scams')
    user_country = $('#user_country')
    user_country_verified = $('#user_country_verified')

    var target = document.querySelector("#search_form")
    var blockUI = new KTBlockUI(target)

    function form_field_changed() {
        search_form.submit()
        blockUI.block()
    }

    function link_and_submit_checkboxes(lg, sm) {
        sm.change(function() {
            lg.prop('checked', this.checked)
            form_field_changed()
        })

        lg.change(function() {
            sm.prop('checked', this.checked)
            form_field_changed()
        })
    }

    link_and_submit_checkboxes(sourcing, sm_sourcing)
    link_and_submit_checkboxes(promoting, sm_promoting)
    link_and_submit_checkboxes(need_logistics, sm_need_logistics)
    link_and_submit_checkboxes(sourcing_agent, sm_sourcing_agent)
    link_and_submit_checkboxes(sales_agent, sm_sales_agent)
    link_and_submit_checkboxes(logistics_agent, sm_logistics_agent)
    link_and_submit_checkboxes(other, sm_other)

    reduce_spams_and_scams.change(function() {
        form_field_changed()
    })

    user_country_verified.change(function() {
        form_field_changed()
    })

    user_country.change(function() {
        form_field_changed()
    })

    via_wechat_id_div = $('#via_wechat_id_div')
    via_wechat = $('#via_wechat')

    function toggle_via_wechat_id_div() {
        if (via_wechat.is(':checked')) {
            via_wechat_id_div.show()
        } else {
            via_wechat_id_div.hide()
        }
    }

    toggle_via_wechat_id_div()

    via_wechat.click(function() {
        toggle_via_wechat_id_div()
    })
})

// These functions are triggered by onclick, and have to be outside document.ready to work.
// This code have to be rendered inline because it has server-side rendered links.

function flag_lead(lead_id, type, button_id, badge_id) {
    url = ''
    if (type == 'spam') {
        url = "{% url 'leads:flag_spam' %}"
    } else if (type == 'scam') {
        url = "{% url 'leads:flag_scam' %}"
    }

    if (url == '') {
        return
    }

    $.post(url,
        {'lead_id': lead_id},
        function(data, status) {
            btn = $('#' + button_id)
            bdg = $('#' + badge_id)
            if (type == 'spam') {
                btn.toggleClass('btn-warning')
                btn.toggleClass('text-warning')
                bdg.html(data['num_spam_flags'])

                amplitude.getInstance().logEvent(
                    'discovery - flagged lead', {
                        'lead id': lead_id,
                        'type': 'spam'
                    }
                )
            } else if (type == 'scam') {
                btn.toggleClass('btn-danger')
                btn.toggleClass('text-danger')
                bdg.html(data['num_scam_flags'])

                amplitude.getInstance().logEvent(
                    'discovery - flagged lead', {
                        'lead id': lead_id,
                        'type': 'scam'
                    }
                )
            }
        }
    )
}
{% endcomment %}
{% block page_custom_javascript %}
{% comment %} <script src="{% static 'leads/js/home.js' %}"></script> {% endcomment %}
{% comment %} <script>$(document).ready((function(){device_id=$("#device_id"),device_id.val(amplitude.getInstance().getDeviceId()),sourcing=$("#sourcing"),promoting=$("#promoting"),need_logistics=$("#need_logistics"),sourcing_agent=$("#sourcing_agent"),sales_agent=$("#sales_agent"),logistics_agent=$("#logistics_agent"),other=$("#other"),sm_sourcing=$("#sm_sourcing"),sm_promoting=$("#sm_promoting"),sm_need_logistics=$("#sm_need_logistics"),sm_sourcing_agent=$("#sm_sourcing_agent"),sm_sales_agent=$("#sm_sales_agent"),sm_logistics_agent=$("#sm_logistics_agent"),sm_other=$("#sm_other"),search_form=$("#search_form"),reduce_spams_and_scams=$("#reduce_spams_and_scams"),user_country=$("#user_country"),user_country_verified=$("#user_country_verified");var e=document.querySelector("#search_form"),s=new KTBlockUI(e);function i(){search_form.submit(),s.block()}function _(e,s){s.change((function(){e.prop("checked",this.checked),i()})),e.change((function(){s.prop("checked",this.checked),i()}))}function c(){via_wechat.is(":checked")?via_wechat_id_div.show():via_wechat_id_div.hide()}_(sourcing,sm_sourcing),_(promoting,sm_promoting),_(need_logistics,sm_need_logistics),_(sourcing_agent,sm_sourcing_agent),_(sales_agent,sm_sales_agent),_(logistics_agent,sm_logistics_agent),_(other,sm_other),reduce_spams_and_scams.change((function(){i()})),user_country_verified.change((function(){i()})),user_country.change((function(){i()})),via_wechat_id_div=$("#via_wechat_id_div"),via_wechat=$("#via_wechat"),c(),via_wechat.click((function(){c()}))}));</script> {% endcomment %}
{% comment %} <script>function flag_lead(a,l,e,t){url="","spam"==l?url="{% url 'leads:flag_spam' %}":"scam"==l&&(url="{% url 'leads:flag_scam' %}"),""!=url&&$.post(url,{lead_id:a},(function(g,s){btn=$("#"+e),bdg=$("#"+t),"spam"==l?(btn.toggleClass("btn-warning"),btn.toggleClass("text-warning"),bdg.html(g.num_spam_flags),amplitude.getInstance().logEvent("discovery - flagged lead",{"lead id":a,type:"spam"})):"scam"==l&&(btn.toggleClass("btn-danger"),btn.toggleClass("text-danger"),bdg.html(g.num_scam_flags),amplitude.getInstance().logEvent("discovery - flagged lead",{"lead id":a,type:"scam"}))}))}</script> {% endcomment %}
{% comment %}
$(document).ready(function() {
    // Hide all lead body
    lead_bodies = $('.lead_body')
    lead_bodies.hide()

    show_more_lead_bodies = $('.show_more_lead_body')
    show_more_lead_bodies.click(function () {
        // Hide button
        $(this).hide()

        // Hide preview and show full lead body
        lead_body_preview = $(this).parent()
        lead_body_preview.siblings('.lead_body').toggle()
        lead_body_preview.toggle()

        lead_id = lead_body_preview.attr("data-lead-id")

        // Log event
        amplitude.getInstance().logEvent('discovery - showed more lead body', { 'lead_id': lead_id })
    })
})
{% endcomment %}
<script src="{% static 'leads/js/lead_item.js' %}"></script>
{% endblock %}