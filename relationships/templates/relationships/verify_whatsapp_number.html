{% extends 'extendables/base_simple.html' %}

{% load static %}

{% block main %}

<div class="d-flex flex-column flex-root">
    <div class="d-flex flex-column flex-column-fluid bgi-position-y-bottom position-x-center bgi-no-repeat bgi-size-contain bgi-attachment-fixed" style="background-image: url({% static 'common/assets/media/illustrations/sketchy-1/14.png' %}">
        <!--begin::Content-->
        <div class="d-flex flex-center flex-column flex-column-fluid p-10 pb-lg-20">
            <!--begin::Logo-->
            <a href="../../demo1/dist/index.html" class="mb-12">
                <img alt="Logo" src="{% static 'common/assets/media/logos/plain-logo.svg' %}" class="h-40px" />
            </a>
            <!--end::Logo-->
            <!--begin::Wrapper-->
            <div class="w-lg-500px bg-body rounded shadow-sm p-10 p-lg-15 mx-auto">
                <!--begin::Form-->
                <form class="form w-100" action="{% url 'relationships:verify_whatsapp_number' token.token %}" method="post">
                    {% csrf_token %}
                    <div class="text-center mb-10">
                        <h2 class="text-dark mb-3">We've sent you a link on WhatsApp, please click it to complete registration.</h1>
                    </div>
                    <div class="fv-row mb-3">
                        <label for="whatsapp_phone_number" class="form-label fs-6 fw-bolder text-dark">Your WhatsApp Phone Number</label>
                        <div class="d-flex d-flex-column">
                            <input name="whatsapp_phone_number" class="form-control form-control-lg" type="text" placeholder="e.g., +14155552671" disabled="true" value="+{{ token.user.phone_number.country_code }}{{ token.user.phone_number.national_number }}" />
                        </div>
                    </div>
                    <div class="text-center">
                        <button type="submit" class="btn btn-lg btn-success w-100 mb-5" disabled="true" id="verify_whatsapp_number__resend_button">
                            Resend Link via WhatsApp
                        </button>
                    </div>
                    <div class="row">
                        <div class="col-12" id="verify_whatsapp_number__">
                            Wait <span class="text-light-info fw-bolder bg-info" id="verify_whatsapp_number__counter_seconds">60</span> seconds to resend link.
                        </div>
                    </div>
                </form>
                <!--end::Form-->
            </div>
            <!--end::Wrapper-->
        </div>
        <!--end::Content-->
    </div>
</div>

{% endblock %}

{% block page_custom_javascript %}
<script type="text/javascript">

var verify_whatsapp_number__counter = function () {
    var start_counter = function() {
        var counter = 60; // Seconds
        var set_interval = setInterval(function() {
            $('#verify_whatsapp_number__counter_seconds').html('' + counter);
            counter--;
            if (counter < 59) {
                clearInterval(set_interval); // Stop this counter
                $('#verify_whatsapp_number__resend_button').removeAttr('disabled') // Enable resend button

            }
        }, 1000);
    };

    return {
        init: function () {
            start_counter();
        }
    }
}();

var verify_whatsapp_number__poll_status = function() {
    var start_poll = function () {
        var counter = 120; // Poll for 5 minutes at most (12 * 2.5s = 5 mins)
        var set_interval = setInterval(function() {
            // TODO: poll backend
            console.log('poll backend' + counter)
            counter--;
            if (counter < 0) {
                clearInterval(set_interval); // Stop this counter
            }
        }, 2500);
    }

    return {
        init: function () {
            start_poll();
        }
    }
}();

jQuery(document).ready(function () {
    verify_whatsapp_number__counter.init();
    verify_whatsapp_number__poll_status.init();
});

</script>
{% endblock %}