{% extends 'extendables/b.html' %}

{% load static %}

{% block page_title %}Alert Contacts{% endblock %}

{% block page_subtitle %}Requirements matching your alert{% endblock %}

{% block actions %}
<a href="" class="btn btn-sm btn-secondary">Back to Alerts</a>
{% endblock %}

{% block content_body %}
<div class="post d-flex flex-column-fluid">
    <div id="kt_content_container" class="container-xxl">
        <div class="card shadow-sm bg-secondary">
            <div class="card-header pb-3 pt-4">
                <div class="card-title">Alert Details</div>
                <div class="card-toolbar d-flex flex-column align-items-end">
                    <div class="badge badge-success">Running</div>
                    <div class="text-muted mt-1">Started 2d ago</div>
                    {% comment %} <span class="text-muted">Last matched 2d ago</span> {% endcomment %}
                    {% comment %} <span class="text-muted">Stopped 2d ago</span> {% endcomment %}
                </div>
            </div>
            <div class="card-body">
                <div>
                    icumsa, Brazil, sugar
                </div>
                <div class="d-flex mt-2">
                    <span class="badge badge-dark">Other</span>
                </div>
                <div class="mt-2">
                    {% comment %} <span class="badge badge-dark">All Countries</span> {% endcomment %}
                    <span class="badge badge-dark">Selected Countries</span>
                    <span class="badge badge-dark">United States of America</span>
                    <span class="badge badge-dark">United States of America</span>
                    <span class="badge badge-dark">United States of America</span>
                    <span class="badge badge-dark">United States of America</span>
                </div>
            </div>
            <div class="card-footer d-flex flex-row-reverse">
                <a href="" class="btn btn-sm btn-light-danger">Stop</a>
            </div>
        </div>

        <div class="d-flex justify-content-between align-items-center mt-8">
            <span class="text-dark fw-bolder"><span data-kt-countup="true" data-kt-countup-value="{{ page_obj.paginator.count }}">0</span> persons</span>
        </div>

        {% comment %} {% if page_obj|length > 0 %} {% endcomment %}
            {% comment %} {% for lead in page_obj %} {% endcomment %}
                {% comment %} {% include 'leads/includes/lead_item.html' with lead=lead %} {% endcomment %}

                <div class="card shadow-sm mt-4">
                    <div class="card-header pb-3 pt-4">
                        <div class="card-title">
                            <div class="d-flex align-items-top">
                                <div class="symbol symbol-45px me-5">
                                    <div class="symbol-label fs-3 bg-light-info text-info">KN</div>
                                </div>
                                <div class="d-flex justify-content-start flex-column">
                                    <div class="text-dark fw-bolder fs-6">Kevin Ng Kevin Ng Kevin Ng</div>
                                    <div class="fw-bold fs-7">Leng Guan Metal Pte Ltd</div>
                                    <div class="text-muted fw-bold fs-7">United States of America</div>
                                    <div class="fw-normal fs-7">I supply medical supplies, resources, etc, etc.</div>
                                </div>
                            </div>
                        </div>
                        <div class="card-toolbar d-flex align-items-start">
                            <span class="text-muted">2d ago</span>
                        </div>
                    </div>

                    <div class="card-body">
                        <div>
                            <div class="lead_body_preview" data-lead-id="{{ lead.id }}">Hello world hello world <span class="text-primary cursor-pointer show_more_lead_body">Show More</span></div>
                            <div class="lead_body" style="display: none;">{{ lead.body|linebreaks }}</div>
                        </div>
                        <div class="mt-2">
                            {% include 'leads/includes/badges/leads/other.html' %}
                        </div>
                    </div>

                    <div class="card-footer">
                        <div class="d-flex justify-content-end">
                            <a href="#" class="btn btn-sm btn-light-info">Details</a>
                        </div>
                    </div>
                </div>


                {% comment %} {% if forloop.counter|divisibleby:5 %}
                    <div class="mt-4" align="center">
                        {% include 'includes/adsense_display_ad_unit.html' %}
                    </div>
                {% endif %}
            {% endfor %}
        {% endif %} {% endcomment %}
    </div>
</div>

{% include 'includes/paginator.html' with hide_pages=True %}
{% endblock %}

{% comment %}
$(document).ready(function() {
    // We have two sets of checkboxes to cater for different screensizes, and we want to link them up.

    // Pass Amplitude device to the backend so we can track unauthenticated users.
    device_id = $('#device_id')
    device_id.val(amplitude.getInstance().getDeviceId())

    sourcing = $('#sourcing')
    promoting = $('#promoting')
    need_logistics = $('#need_logistics')
    sourcing_agent = $('#sourcing_agent')
    sales_agent = $('#sales_agent')
    logistics_agent = $('#logistics_agent')
    other = $('#other')

    sm_sourcing = $('#sm_sourcing')
    sm_promoting = $('#sm_promoting')
    sm_need_logistics = $('#sm_need_logistics')
    sm_sourcing_agent = $('#sm_sourcing_agent')
    sm_sales_agent = $('#sm_sales_agent')
    sm_logistics_agent = $('#sm_logistics_agent')
    sm_other = $('#sm_other')

    search_form = $('#search_form')
    reduce_spams_and_scams = $('#reduce_spams_and_scams')
    user_country = $('#user_country')
    user_country_verified = $('#user_country_verified')

    var target = document.querySelector("#search_form")
    var blockUI = new KTBlockUI(target)

    function form_field_changed() {
        search_form.submit()
        blockUI.block()
    }

    function link_and_submit_checkboxes(lg, sm) {
        sm.change(function() {
            lg.prop('checked', this.checked)
            form_field_changed()
        })

        lg.change(function() {
            sm.prop('checked', this.checked)
            form_field_changed()
        })
    }

    link_and_submit_checkboxes(sourcing, sm_sourcing)
    link_and_submit_checkboxes(promoting, sm_promoting)
    link_and_submit_checkboxes(need_logistics, sm_need_logistics)
    link_and_submit_checkboxes(sourcing_agent, sm_sourcing_agent)
    link_and_submit_checkboxes(sales_agent, sm_sales_agent)
    link_and_submit_checkboxes(logistics_agent, sm_logistics_agent)
    link_and_submit_checkboxes(other, sm_other)

    reduce_spams_and_scams.change(function() {
        form_field_changed()
    })

    user_country_verified.change(function() {
        form_field_changed()
    })

    user_country.change(function() {
        form_field_changed()
    })

    via_wechat_id_div = $('#via_wechat_id_div')
    via_wechat = $('#via_wechat')

    function toggle_via_wechat_id_div() {
        if (via_wechat.is(':checked')) {
            via_wechat_id_div.show()
        } else {
            via_wechat_id_div.hide()
        }
    }

    toggle_via_wechat_id_div()

    via_wechat.click(function() {
        toggle_via_wechat_id_div()
    })
})

// These functions are triggered by onclick, and have to be outside document.ready to work.
// This code have to be rendered inline because it has server-side rendered links.

function flag_lead(lead_id, type, button_id, badge_id) {
    url = ''
    if (type == 'spam') {
        url = "{% url 'leads:flag_spam' %}"
    } else if (type == 'scam') {
        url = "{% url 'leads:flag_scam' %}"
    }

    if (url == '') {
        return
    }

    $.post(url,
        {'lead_id': lead_id},
        function(data, status) {
            btn = $('#' + button_id)
            bdg = $('#' + badge_id)
            if (type == 'spam') {
                btn.toggleClass('btn-warning')
                btn.toggleClass('text-warning')
                bdg.html(data['num_spam_flags'])

                amplitude.getInstance().logEvent(
                    'discovery - flagged lead', {
                        'lead id': lead_id,
                        'type': 'spam'
                    }
                )
            } else if (type == 'scam') {
                btn.toggleClass('btn-danger')
                btn.toggleClass('text-danger')
                bdg.html(data['num_scam_flags'])

                amplitude.getInstance().logEvent(
                    'discovery - flagged lead', {
                        'lead id': lead_id,
                        'type': 'scam'
                    }
                )
            }
        }
    )
}
{% endcomment %}
{% block page_custom_javascript %}
{% comment %} <script src="{% static 'leads/js/home.js' %}"></script> {% endcomment %}
{% comment %} <script>$(document).ready((function(){device_id=$("#device_id"),device_id.val(amplitude.getInstance().getDeviceId()),sourcing=$("#sourcing"),promoting=$("#promoting"),need_logistics=$("#need_logistics"),sourcing_agent=$("#sourcing_agent"),sales_agent=$("#sales_agent"),logistics_agent=$("#logistics_agent"),other=$("#other"),sm_sourcing=$("#sm_sourcing"),sm_promoting=$("#sm_promoting"),sm_need_logistics=$("#sm_need_logistics"),sm_sourcing_agent=$("#sm_sourcing_agent"),sm_sales_agent=$("#sm_sales_agent"),sm_logistics_agent=$("#sm_logistics_agent"),sm_other=$("#sm_other"),search_form=$("#search_form"),reduce_spams_and_scams=$("#reduce_spams_and_scams"),user_country=$("#user_country"),user_country_verified=$("#user_country_verified");var e=document.querySelector("#search_form"),s=new KTBlockUI(e);function i(){search_form.submit(),s.block()}function _(e,s){s.change((function(){e.prop("checked",this.checked),i()})),e.change((function(){s.prop("checked",this.checked),i()}))}function c(){via_wechat.is(":checked")?via_wechat_id_div.show():via_wechat_id_div.hide()}_(sourcing,sm_sourcing),_(promoting,sm_promoting),_(need_logistics,sm_need_logistics),_(sourcing_agent,sm_sourcing_agent),_(sales_agent,sm_sales_agent),_(logistics_agent,sm_logistics_agent),_(other,sm_other),reduce_spams_and_scams.change((function(){i()})),user_country_verified.change((function(){i()})),user_country.change((function(){i()})),via_wechat_id_div=$("#via_wechat_id_div"),via_wechat=$("#via_wechat"),c(),via_wechat.click((function(){c()}))}));</script> {% endcomment %}
{% comment %} <script>function flag_lead(a,l,e,t){url="","spam"==l?url="{% url 'leads:flag_spam' %}":"scam"==l&&(url="{% url 'leads:flag_scam' %}"),""!=url&&$.post(url,{lead_id:a},(function(g,s){btn=$("#"+e),bdg=$("#"+t),"spam"==l?(btn.toggleClass("btn-warning"),btn.toggleClass("text-warning"),bdg.html(g.num_spam_flags),amplitude.getInstance().logEvent("discovery - flagged lead",{"lead id":a,type:"spam"})):"scam"==l&&(btn.toggleClass("btn-danger"),btn.toggleClass("text-danger"),bdg.html(g.num_scam_flags),amplitude.getInstance().logEvent("discovery - flagged lead",{"lead id":a,type:"scam"}))}))}</script> {% endcomment %}
{% comment %}
$(document).ready(function() {
    // Hide all lead body
    lead_bodies = $('.lead_body')
    lead_bodies.hide()

    show_more_lead_bodies = $('.show_more_lead_body')
    show_more_lead_bodies.click(function () {
        // Hide button
        $(this).hide()

        // Hide preview and show full lead body
        lead_body_preview = $(this).parent()
        lead_body_preview.siblings('.lead_body').toggle()
        lead_body_preview.toggle()

        lead_id = lead_body_preview.attr("data-lead-id")

        // Log event
        amplitude.getInstance().logEvent('discovery - showed more lead body', { 'lead_id': lead_id })
    })
})
{% endcomment %}
<script src="{% static 'leads/js/lead_item.js' %}"></script>
{% endblock %}