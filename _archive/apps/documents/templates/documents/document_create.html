{% extends 'extendables/base.html' %}

{% load static %}

{% load widget_tweaks %}

{% block title %}
    Create Document
{% endblock %}

{% block content_header %}
    <form method="post" action="{% url 'documents:create' %}">
        {% csrf_token %}
{% endblock %}

{% block subtitle %}
    Create Document
{% endblock %}

{% block toolbar %}
    <a href="{% url 'documents:list' %}" class="btn btn-warning">Cancel</a>
    <button id="document__create_document_button" type="submit" href="#" class="btn btn-success">Create Document</button>
{% endblock %}

{% block content %}
    <div class="kt-container kt-grid__item kt-grid__item--fluid">
        <div class="kt-portlet kt-portlet--mobile">
            <div class="kt-portlet__body">
                <div class="row">
                    <div class="col-lg-3 form-group">
                        <label>Document Type</label>
                        {{ form.document_type|add_class:"form-control"|add_class:"kt-selectpicker"|add_error_class:"is-invalid"|attr:"id:document__document_type"|attr:"data-size:7"|attr:"data-live-search:true" }}
                        {% if form.document_type.errors %}
                            <div class="invalid-feedback">{% for error in form.document_type.errors %}{{ error }} {% endfor %}</div>
                        {% endif %}
                    </div>
                    <div class="col-lg-4 form-group">
                        <label>Material Name</label>
                        <select id="document__material_name" class="form-control kt-selectpicker" data-size="7" data-live-search="true">
                            {% for material in materials %}
                                <option value="{{ material.id }}">{{ material.name }}</option>
                            {% endfor %}
                        </select>
                        {% if form.material.errors %}
                            <div class="invalid-feedback">{% for error in form.material.errors %}{{ error }} {% endfor %}</div>
                        {% endif %}
                    </div>
                    <div class="col-lg-3 form-group">
                        <label>Material Code</label>
                        <select id="document__material_code" class="form-control kt-selectpicker" data-size="7" data-live-search="true">
                            {% for material in materials %}
                                <option value="{{ material.id }}">{{ material.code }}</option>
                            {% endfor %}
                        </select>
                        {% if form.material.errors %}
                            <div class="invalid-feedback">{% for error in form.material.errors %}{{ error }} {% endfor %}</div>
                        {% endif %}
                    </div>
                </div>
                <span id='document__batch_code_span' class="kt-hidden">
                    <div class="kt-separator kt-separator--portlet-fit"></div>
                    <div class="row">
                        <div class="col-lg-3 form-group">
                            <label class="form-control-label" for="document__batch_code_input">Batch Code</label>
                            {{ form.batch_code|add_class:"form-control"|add_error_class:"is-invalid"|attr:"id:document__batch_code_input" }}
                            {% if form.batch_code.errors %}
                                <div class="invalid-feedback">{% for error in form.batch_code.errors %}{{ error }} {% endfor %}</div>
                            {% endif %}
                        </div>
                    </div>
                </span>
            </div>
        </div>

        <div id="document__file_input_portlet" class="kt-portlet kt-portlet--mobile">
            <div class="kt-portlet__body">
                <div class="row">
                    <div class="col-lg-3"></div>
                    <div class="col-lg-6 form-group">
                        <label>Document File</label>
                        <div class="custom-file">
                            <input id="document__document_file_input" type="file" class="custom-file-input{% if form.file_id.errors %} is-invalid{% endif %}">
                            <label for="document__document_file_input" class="custom-file-label">Choose document PDF file</label>
                            {% if form.file_id.errors %}
                                <div class="invalid-feedback">Please select a PDF file for this document.</div>
                            {% endif %}
                            <div id="document__document_file_input_error_pdf_only" class="invalid-feedback kt-hidden">Only PDF file supported.</div>
                            <div id="document__document_file_input_error_cannot_upload" class="invalid-feedback kt-hidden">Unable to upload file. Please try again.</div>
                        </div>
                        <span class="form-text text-muted">Don't worry if the filepath begins with 'C:\fakepath'. This is a browser security feature.</span>
                    </div>
                    <div class="col-lg-3"></div>
                </div>
            </div>
        </div>

        <div id="document__document_file"></div>

        {{ form.file_id|attr:"id:document__file_id" }}
        {{ form.material_id|attr:"id:document__material_id" }}
    </div>
{% endblock %}

{% block content_footer %}
    </form>
{% endblock %}

{% block page_level_scripts %}
    <script src="{% static 'common/assets/js/pages/crud/forms/widgets/select2.js' %}" type="text/javascript"></script>
    <script src="{% static 'common/assets/plugins/pdfobject/pdfobject.min.js' %}" type="text/javascript"></script>
    {% include 'documents/js/document.js' %}
{% endblock %}