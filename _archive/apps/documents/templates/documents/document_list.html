{% extends 'extendables/base.html' %}

{% load static %}

{% block title %}
    Documents
{% endblock %}

{% block content_header %}
    <form method="get" action="{% url 'documents:list' %}">
{% endblock %}

{% block subtitle %}
    Documents
{% endblock %}

{% block toolbar %}
    <a href="{% url 'documents:create' %}" class="btn btn-primary"><i class="flaticon2-plus"></i>New Document</a>
{% endblock %}

{% block content %}
    <div class="kt-container  kt-grid__item kt-grid__item--fluid">
        <div class="row">
            <div class="col-lg-3">
                <div class="kt-portlet">
                    <div class="kt-portlet__body">

                        <button type="submit" class="btn btn-primary kt-margin-b-20"><i class="flaticon-refresh"></i>Refresh</button>
                        <div class="kt-separator kt-separator--border"></div>
                        <div class="form-group">
                            <label>Document Type</label>
                            <select class="form-control kt-selectpicker" data-size="7" data-live-search="true">
                                {% for type in document_types %}
                                    <option value="{{ type.id }}">{{ type.name }} ({{ type.acronym }})</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="kt-separator kt-separator--border"></div>
                        <div class="form-group">
                            <label>Material Name</label>
                            <input name="material_name" type="text" class="form-control" placeholder="Leave blank to show all" value="{{ request.GET.material_name }}">
                        </div>
                        <div class="form-group">
                            <label>Material Code</label>
                            <input name="material_code" type="search" class="form-control" placeholder="Leave blank to show all" value="{{ request.GET.material_code }}">
                        </div>
                        <div class="form-group">
                            <label>Batch Code</label>
                            <input name="batch_code" type="search" class="form-control" placeholder="Leave blank to show all" value="{{ request.GET.batch_code }}">
                        </div>

                        <div class="kt-separator kt-separator--border-dashed"></div>
                        <div class="row kt-margin-b-20">
                            <h6>Created Date</h6>
                        </div>
                        <div class="form-group">
                            <div class="input-daterange input-group" id="document__datepicker">
                                <input type="text" class="form-control" name="created_start_date" value="{{ request.GET.created_start_date }}" />
                                <div class="input-group-append">
                                    <span class="input-group-text"><i class="la la-ellipsis-h"></i></span>
                                </div>
                                <input type="text" class="form-control" name="created_end_date" value="{{ request.GET.created_end_date }}" />
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-9">

                {% if document_list %}

                    {% for document in document_list %}

                        {% cycle '<div class="row">' '' '' %}

                        <div class="col-lg-4">
                            <div class="kt-portlet kt-portlet--height-fluid">                            
                                <div class="kt-portlet__head kt-portlet__head--noborder kt-margin-t-5">
                                    <div class="kt-portlet__head-label">
                                        <h3 class="kt-portlet__head-title">
                                            {{ document.material.name }}
                                        </h3>
                                    </div>
                                </div>
                                <div class="kt-portlet__body">
                                    <div class="kt-widget kt-widget--user-profile-2">
                                    
                                        <div class="kt-widget__body">
                                            <div class="kt-widget__item">
                                                <div class="kt-widget__contact">
                                                    <span class="kt-widget__label">Material Code</span>
                                                    <span class="kt-widget__data">{{ document.material.code }}</span>
                                                </div>
                                                {% if document.batch %}
                                                <div class="kt-widget__contact">
                                                    <span class="kt-widget__label">Batch Code</span>
                                                    <span class="kt-widget__data">{{ document.batch.code }}</span>
                                                </div>
                                                {% endif %}
                                                <div class="kt-widget__contact">
                                                    <span class="kt-widget__label">Created</span>
                                                    <span class="kt-widget__data">{{ document.created }}</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="kt-widget__footer">
                                            <a href="{% url 'documents:details' document.id %}" class="btn btn-outline-secondary btn-lg">{{ document.document_type.name }} ({{ document.document_type.acronym }})</a>
                                        </div>
                                    </div>             
                                </div>
                            </div>
                        </div>

                        {% cycle '' '' '</div>' %}

                    {% endfor %}

                    {% if not document_list|length|divisibleby:3 %}
                        </div>
                    {% endif %}

                {% endif %}

                <!-- begin:: Paginator -->
                <div class="row">
                    <div class="col-xl-12">
                        <div class="kt-portlet">
                            <div class="kt-portlet__body">
                                <div class="kt-pagination kt-pagination--brand">
                                    <ul class="kt-pagination__links">
                                        {% if is_paginated %}

                                            {% if page_obj.has_previous %}
                                                <li class="kt-pagination__link--first">
                                                    <a href="{% url 'documents:list' %}?page=1"><i class="fa fa-angle-double-left kt-font-brand"></i></a>
                                                </li>
                                                <li class="kt-pagination__link--next">
                                                    <a href="{% url 'documents:list' %}?page={{ page_obj.previous_page_number }}"><i class="fa fa-angle-left kt-font-brand"></i></a>
                                                </li>
                                            {% endif %}

                                            {% for i in paginator.page_range %}
                                                {% if page_obj.number == i %}
                                                    <li class="kt-pagination__link--active">
                                                        <a href="#">{{ i }}</a>
                                                    </li>
                                                {% elif i < page_obj.number and i > 3 and i == page_obj.number|add:-1 %}
                                                    <li>
                                                        <a href="{% url 'documents:list' %}?page={{ i }}">...</a>
                                                    </li>
                                                {% elif i > page_obj.number and i < page_obj.num_pages|add:-3 and i == page_obj.number|add:+1 %}
                                                    <li>
                                                        <a href="{% url 'documents:list' %}?page={{ i }}">...</a>
                                                    </li>
                                                {% else %}
                                                    <li>
                                                        <a href="{% url 'documents:list' %}?page={{ i }}">{{ i }}</a>
                                                    </li>
                                                {% endif %}
                                            {% endfor %}

                                            {% if page_obj.has_next %}
                                                <li class="kt-pagination__link--prev">
                                                    <a href="{% url 'documents:list' %}?page={{ page_obj.next_page_number }}"><i class="fa fa-angle-right kt-font-brand"></i></a>
                                                </li>
                                                <li class="kt-pagination__link--last">
                                                    <a href="{% url 'documents:list' %}?page={{ page_obj.paginator.num_pages }}"><i class="fa fa-angle-double-right kt-font-brand"></i></a>
                                                </li>
                                            {% endif %}

                                        {% endif %}
                                    </ul>
                                    <div class="kt-pagination__toolbar">
                                        <span class="pagination__desc">
                                            {{ material_list|length }} Results
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- end:: Paginator -->
            </div>
        </div>
    </div>
{% endblock %}

{% block content_footer %}
    </form>
{% endblock %}

{% block page_level_scripts %}
    <script src="{% static 'common/assets/js/pages/crud/forms/widgets/select2.js' %}" type="text/javascript"></script>
    <script type="text/javascript">
        // Initialize select picker
        var document__selectpicker = function () {
            var init_selectpicker = function () {
                $('.kt-selectpicker').selectpicker();
            }

            return {
                run: function () {
                    init_selectpicker(); 
                }
            };
        }();

        // Initialize datepicker
        var document__datepicker = function () {
            var init_datepicker = function () {
                arrows = {
                    leftArrow: '<i class="la la-angle-left"></i>',
                    rightArrow: '<i class="la la-angle-right"></i>'
                }

                $('#document__datepicker, #document__datepicker_validate').datepicker({
                    todayBtn: "linked",
                    clearBtn: true,
                    todayHighlight: true,
                    templates: arrows
                });
            }

            return {
                run: function () {
                    init_datepicker(); 
                }
            };
        }();

        // Call all functions on document ready
        jQuery(document).ready(function () {
            document__selectpicker.run();
            document__datepicker.run();
        });
    </script>
{% endblock %}